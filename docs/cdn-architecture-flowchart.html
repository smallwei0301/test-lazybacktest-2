<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LazyBacktest CDN æ¶æ§‹èˆ‡è³‡æ–™æµå‘åœ–</title>
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-primary: #0f1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent: #58a6ff;
            --accent-dim: rgba(88, 166, 255, 0.15);
            --border: #30363d;
            --success: #3fb950;
            --warning: #d29922;
            --danger: #f85149;
            --code-bg: #161b22;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            margin-bottom: 3rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            margin: 0 0 1rem 0;
            background: linear-gradient(90deg, #58a6ff, #a371f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-secondary);
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            font-size: 1.5rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.75rem;
            margin-top: 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        h2::before {
            content: '#';
            color: var(--accent);
        }

        h3 {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        /* Mermaid Diagrams */
        .mermaid {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            margin: 1.5rem 0;
            border: 1px solid var(--border);
        }

        /* Tables */
        .table-wrapper {
            overflow-x: auto;
            margin: 1.5rem 0;
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        th,
        td {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        th {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 600;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background-color: var(--bg-tertiary);
        }

        /* Code Blocks */
        pre {
            background-color: var(--bg-primary);
            border-radius: 6px;
            padding: 1rem;
            overflow-x: auto;
            border: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: var(--accent-dim);
            color: var(--accent);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85em;
        }

        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
            font-size: 1em;
        }

        /* Lists */
        ul,
        ol {
            padding-left: 1.5rem;
            color: var(--text-secondary);
        }

        li {
            margin-bottom: 0.5rem;
        }

        strong {
            color: var(--text-primary);
        }

        /* Status colors for table cells if needed */
        .status-ok {
            color: var(--success);
        }

        .status-warn {
            color: var(--warning);
        }

        .status-err {
            color: var(--danger);
        }

        footer {
            text-align: center;
            color: var(--text-secondary);
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>LazyBacktest CDN æ¶æ§‹èˆ‡è³‡æ–™æµå‘åœ–</h1>
            <div class="meta">
                ç‰ˆæœ¬: LB-CDN-ARCH-20251209A | ç›®çš„: èªªæ˜å°è‚¡èˆ‡ç¾è‚¡çš„ CDN åŠŸèƒ½æ¶æ§‹èˆ‡è³‡æ–™æµå‘
            </div>
        </header>

        <section>
            <h2>ä¸€ã€ç³»çµ±æ¶æ§‹ç¸½è¦½</h2>
            <div class="mermaid">
                flowchart TB
                subgraph Client["ğŸ–¥ï¸ å®¢æˆ¶ç«¯ (ç€è¦½å™¨)"]
                UI["å›æ¸¬ä»‹é¢"]
                Worker["Web Worker"]
                IDB["IndexedDB<br>(Year Superset)"]
                Memory["è¨˜æ†¶é«”å¿«å–"]
                end

                subgraph CDN["ğŸŒ Netlify CDN å±¤"]
                CDNL["CDN Edge Cache<br>s-maxage=3600~31536000"]
                end

                subgraph Functions["âš¡ Netlify Functions (Serverless)"]
                StockRange["stock-range.js<br>(å¹´åº¦å¿«å–å½™æ•´)"]
                TWSEProxy["twse-proxy.js<br>(å°è‚¡ TWSE/TPEX)"]
                USProxy["us-proxy.js<br>(ç¾è‚¡)"]
                TPEXProxy["tpex-proxy.js<br>(ä¸Šæ«ƒ)"]
                end

                subgraph Blob["ğŸ’¾ Netlify Blobs Storage"]
                YearCache["Year Cache Store<br>(stock_year_cache_store)"]
                TWSECache["TWSE Cache Store<br>(twse_cache_store)"]
                TPEXCache["TPEX Cache Store<br>(tpex_cache_store)"]
                USCache["US Price Store<br>(us_price_store)"]
                end

                subgraph External["ğŸŒ å¤–éƒ¨è³‡æ–™ä¾†æº"]
                TWSE["è­‰äº¤æ‰€ TWSE API"]
                TPEX["æ«ƒè²·ä¸­å¿ƒ TPEX API"]
                FinMind["FinMind API"]
                Yahoo["Yahoo Finance API"]
                end

                UI --> Worker
                Worker --> Memory
                Worker --> IDB
                Worker --> CDNL
                CDNL --> StockRange
                CDNL --> TWSEProxy
                CDNL --> USProxy
                CDNL --> TPEXProxy

                StockRange --> YearCache
                TWSEProxy --> TWSECache
                TPEXProxy --> TPEXCache
                USProxy --> USCache

                TWSEProxy --> TWSE
                TWSEProxy --> FinMind
                TWSEProxy --> Yahoo
                TPEXProxy --> Yahoo
                TPEXProxy --> FinMind
                USProxy --> FinMind
                USProxy --> Yahoo
            </div>
        </section>

        <section>
            <h2>äºŒã€å°è‚¡è³‡æ–™æµå‘åœ–</h2>

            <h3>2.1 å°è‚¡å®Œæ•´æµç¨‹åœ–</h3>
            <div class="mermaid">
                flowchart TD
                subgraph è«‹æ±‚éšæ®µ
                A["ç”¨æˆ¶ç™¼èµ·å›æ¸¬è«‹æ±‚<br>(è‚¡è™Ÿã€æ—¥æœŸç¯„åœ)"]
                B["Worker è¨ˆç®—æŸ¥è©¢ç¯„åœ"]
                C{"IndexedDB<br>Year Superset<br>å‘½ä¸­?"}
                end

                subgraph æœ¬åœ°å¿«å–å±¤
                D["ä½¿ç”¨æœ¬åœ°å¿«å–è³‡æ–™"]
                E["è¨ˆç®—ç¼ºå£ç¯„åœ"]
                end

                subgraph CDNå±¤["CDN å±¤"]
                F["Worker å‘¼å« stock-range.js"]
                G{"Netlify CDN<br>Edge Cache<br>å‘½ä¸­?"}
                H["CDN å›å‚³å¿«å–<br>TTL: æ­·å²=1å¹´, ç•¶å‰=1å°æ™‚"]
                end

                subgraph Blobå±¤["Netlify Blob å±¤"]
                I["stock-range è®€å–<br>Year Cache Store"]
                J{"Blob Year Cache<br>å‘½ä¸­?"}
                K["Blob å›å‚³å¹´åº¦è³‡æ–™"]
                end

                subgraph Proxyå±¤["Proxy å±¤"]
                L["å‘¼å« twse-proxy.js"]
                M["è®€å– TWSE Cache Store"]
                N{"æœˆåº¦å¿«å–<br>å‘½ä¸­?"}
                O["TWSE æœˆåº¦å¿«å–å‘½ä¸­"]
                end

                subgraph å¤–éƒ¨API["å¤–éƒ¨ API å±¤"]
                P["å‘¼å«è­‰äº¤æ‰€ TWSE API"]
                Q{"TWSE æˆåŠŸ?"}
                R["FinMind å‚™æ´"]
                S["Yahoo Finance å‚™æ´"]
                end

                subgraph å›å­˜éšæ®µ
                T["å¯«å…¥æœˆåº¦å¿«å–"]
                U["è§¸ç™¼ Year Cache é‡å»º"]
                V["å›å­˜ IndexedDB"]
                W["å›å‚³çµ¦ Worker"]
                end

                A --> B --> C
                C -->|æ˜¯| D
                C -->|å¦| E --> F --> G
                G -->|æ˜¯| H --> W
                G -->|å¦| I --> J
                J -->|æ˜¯| K --> W
                J -->|å¦| L --> M --> N
                N -->|æ˜¯| O --> W
                N -->|å¦| P --> Q
                Q -->|æ˜¯| T --> U --> W
                Q -->|å¦| R --> T
                R -.->|å¤±æ•—| S --> T
                W --> V
            </div>

            <h3>2.2 å°è‚¡è³‡æ–™ä¾†æºå„ªå…ˆç´š</h3>
            <div class="mermaid">
                flowchart LR
                subgraph Primary["ä¸»è¦ä¾†æº"]
                A["1ï¸âƒ£ TWSE è­‰äº¤æ‰€<br>(ä¸Šå¸‚è‚¡ç¥¨)"]
                end

                subgraph Fallback["å‚™æ´ä¾†æº"]
                B["2ï¸âƒ£ FinMind API<br>(TWSE å¤±æ•—æ™‚)"]
                C["3ï¸âƒ£ Yahoo Finance<br>(åƒ…é™é‚„åŸåƒ¹æ ¼)"]
                end

                A -->|å¤±æ•—| B
                B -->|å¤±æ•—| C
            </div>

            <h3>2.3 å°è‚¡å¿«å–å±¤ç´šèˆ‡ TTL</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>å¿«å–å±¤ç´š</th>
                            <th>å„²å­˜ä½ç½®</th>
                            <th>TTL (å­˜æ´»æ™‚é–“)</th>
                            <th>èªªæ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>L1: è¨˜æ†¶é«”å¿«å–</strong></td>
                            <td>Worker è®Šæ•¸</td>
                            <td>å–®æ¬¡å›æ¸¬</td>
                            <td>æœ€å¿«å­˜å–ï¼Œå–®æ¬¡è«‹æ±‚å…§æœ‰æ•ˆ</td>
                        </tr>
                        <tr>
                            <td><strong>L2: IndexedDB</strong></td>
                            <td>ç€è¦½å™¨æœ¬åœ°</td>
                            <td>æ°¸ä¹… (å¸¶ç‰ˆæœ¬)</td>
                            <td>Year Supersetï¼Œè·¨å›æ¸¬æŒä¹…åŒ–</td>
                        </tr>
                        <tr>
                            <td><strong>L3: CDN Edge</strong></td>
                            <td>Netlify CDN</td>
                            <td>æ­·å²=1å¹´, ç•¶å‰=1hr</td>
                            <td>CDN é‚Šç·£å¿«å–</td>
                        </tr>
                        <tr>
                            <td><strong>L4: Blob Year Cache</strong></td>
                            <td>Netlify Blobs</td>
                            <td>2-3 å¤©</td>
                            <td>å¹´åº¦å½™ç¸½è³‡æ–™</td>
                        </tr>
                        <tr>
                            <td><strong>L5: Blob Month Cache</strong></td>
                            <td>Netlify Blobs</td>
                            <td>24 å°æ™‚</td>
                            <td>æœˆåº¦åŸå§‹è³‡æ–™</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section>
            <h2>ä¸‰ã€ç¾è‚¡è³‡æ–™æµå‘åœ–</h2>

            <h3>3.1 ç¾è‚¡å®Œæ•´æµç¨‹åœ–</h3>
            <div class="mermaid">
                flowchart TD
                subgraph è«‹æ±‚éšæ®µ["è«‹æ±‚éšæ®µ"]
                A["ç”¨æˆ¶ç™¼èµ·ç¾è‚¡å›æ¸¬<br>(å¦‚ AAPLã€MSFT)"]
                B["Worker è­˜åˆ¥ç¾è‚¡ä»£è™Ÿ"]
                C["å‘¼å« us-proxy.js"]
                end

                subgraph CDNå±¤["CDN å±¤"]
                D{"Netlify CDN<br>Edge Cache<br>å‘½ä¸­?"}
                E["CDN å›å‚³å¿«å–"]
                end

                subgraph Cacheå±¤["Netlify Blob å±¤"]
                F["è®€å– us_price_store"]
                G{"Memory Cache<br>å‘½ä¸­?"}
                H["è¨˜æ†¶é«”å¿«å–å›å‚³"]
                I{"Blob Cache<br>å‘½ä¸­?"}
                J["Blob å¿«å–å›å‚³"]
                end

                subgraph APIå±¤["å¤–éƒ¨ API å±¤"]
                K["å‘¼å« FinMind<br>USStockPrice"]
                L{"FinMind æˆåŠŸä¸”<br>æœ‰è³‡æ–™?"}
                M["å›å‚³ FinMind è³‡æ–™"]
                N["å‘¼å« Yahoo Finance<br>å‚™æ´"]
                O{"Yahoo æˆåŠŸ?"}
                P["å›å‚³ Yahoo è³‡æ–™"]
                Q["é›™ä¾†æºçš†å¤±æ•—<br>å›å‚³éŒ¯èª¤"]
                end

                subgraph å›å­˜éšæ®µ["å›å­˜éšæ®µ"]
                R["å¯«å…¥ Memory + Blob"]
                S["è¨­å®š CDN Header<br>s-maxage"]
                end

                A --> B --> C --> D
                D -->|æ˜¯| E
                D -->|å¦| F --> G
                G -->|æ˜¯| H
                G -->|å¦| I
                I -->|æ˜¯| J
                I -->|å¦| K --> L
                L -->|æ˜¯| M --> R --> S
                L -->|å¦| N --> O
                O -->|æ˜¯| P --> R
                O -->|å¦| Q
            </div>

            <h3>3.2 ç¾è‚¡è³‡æ–™ä¾†æºå„ªå…ˆç´š</h3>
            <div class="mermaid">
                flowchart LR
                subgraph Primary["ä¸»è¦ä¾†æº"]
                A["1ï¸âƒ£ FinMind API<br>(USStockPrice)"]
                end

                subgraph Fallback["å‚™æ´ä¾†æº"]
                B["2ï¸âƒ£ Yahoo Finance<br>(FinMind ç„¡è³‡æ–™æˆ–å¤±æ•—)"]
                end

                A -->|å¤±æ•—æˆ–ç„¡è³‡æ–™| B
            </div>

            <h3>3.3 ç¾è‚¡å¿«å–å±¤ç´šèˆ‡ TTL</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>å¿«å–å±¤ç´š</th>
                            <th>å„²å­˜ä½ç½®</th>
                            <th>TTL (å­˜æ´»æ™‚é–“)</th>
                            <th>èªªæ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>L1: è¨˜æ†¶é«”å¿«å–</strong></td>
                            <td>Function è®Šæ•¸</td>
                            <td>12 å°æ™‚</td>
                            <td>Netlify Function è¨˜æ†¶é«”</td>
                        </tr>
                        <tr>
                            <td><strong>L2: CDN Edge</strong></td>
                            <td>Netlify CDN</td>
                            <td>æ­·å²=1å¹´, ç•¶å‰=1hr</td>
                            <td>CDN é‚Šç·£å¿«å–</td>
                        </tr>
                        <tr>
                            <td><strong>L3: Blob Cache</strong></td>
                            <td>us_price_store</td>
                            <td>12 å°æ™‚</td>
                            <td>åƒ¹æ ¼è³‡æ–™å¿«å–</td>
                        </tr>
                        <tr>
                            <td><strong>L4: Info Cache</strong></td>
                            <td>us_info_store</td>
                            <td>7 å¤©</td>
                            <td>è‚¡ç¥¨åŸºæœ¬è³‡è¨Šå¿«å–</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section>
            <h2>å››ã€CDN å¿«å–ç­–ç•¥è©³è§£</h2>

            <h3>4.1 å‹•æ…‹å¿«å–ç­–ç•¥</h3>
            <div class="mermaid">
                flowchart TD
                A["åˆ¤æ–·è«‹æ±‚æ—¥æœŸç¯„åœ"]
                B{"çµæŸæ—¥æœŸ å°æ–¼ ä»Šæ—¥?"}
                C["æ­·å²è³‡æ–™æ¨¡å¼"]
                D["ç•¶å‰è³‡æ–™æ¨¡å¼"]
                E["Cache-Control:<br>max-age=31536000<br>immutable"]
                F["Cache-Control:<br>max-age=3600"]
                G["Netlify-CDN-Cache-Control:<br>s-maxage=31536000"]
                H["Netlify-CDN-Cache-Control:<br>s-maxage=3600"]

                A --> B
                B -->|æ˜¯| C --> E --> G
                B -->|å¦| D --> F --> H
            </div>

            <h3>4.2 CDN Header è¨­å®š</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>è³‡æ–™é¡å‹</th>
                            <th>Cache-Control</th>
                            <th>CDN s-maxage</th>
                            <th>èªªæ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>æ­·å²è³‡æ–™</strong></td>
                            <td><code>public, max-age=31536000, immutable</code></td>
                            <td>1 å¹´ (31536000s)</td>
                            <td>æ­·å²ä¸è®Šï¼Œæ¥µé•·å¿«å–</td>
                        </tr>
                        <tr>
                            <td><strong>ç•¶å‰è³‡æ–™</strong></td>
                            <td><code>public, max-age=3600</code></td>
                            <td>1 å°æ™‚ (3600s)</td>
                            <td>éœ€è¦å®šæœŸæ›´æ–°</td>
                        </tr>
                        <tr>
                            <td><strong>è‚¡ç¥¨è³‡è¨Š</strong></td>
                            <td><code>public, max-age=604800</code></td>
                            <td>1 é€± (604800s)</td>
                            <td>åŸºæœ¬è³‡æ–™è®Šå‹•å°‘</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section>
            <h2>äº”ã€å°è‚¡ vs ç¾è‚¡ å°æ¯”</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>ç‰¹å¾µ</th>
                            <th>å°è‚¡ (TWSE/TPEX)</th>
                            <th>ç¾è‚¡ (US)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ä¸»è¦ä¾†æº</strong></td>
                            <td>TWSE è­‰äº¤æ‰€ API</td>
                            <td>FinMind USStockPrice</td>
                        </tr>
                        <tr>
                            <td><strong>å‚™æ´ä¾†æº 1</strong></td>
                            <td>FinMind</td>
                            <td>Yahoo Finance</td>
                        </tr>
                        <tr>
                            <td><strong>å‚™æ´ä¾†æº 2</strong></td>
                            <td>Yahoo Finance (é‚„åŸåƒ¹)</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><strong>Proxy å‡½å¼</strong></td>
                            <td><code>twse-proxy.js</code>, <code>tpex-proxy.js</code></td>
                            <td><code>us-proxy.js</code></td>
                        </tr>
                        <tr>
                            <td><strong>å¹´åº¦å¿«å–</strong></td>
                            <td><span class="status-ok">âœ…</span> <code>stock_year_cache_store</code></td>
                            <td><span class="status-err">âŒ</span> ç„¡å¹´åº¦å½™ç¸½</td>
                        </tr>
                        <tr>
                            <td><strong>æœˆåº¦å¿«å–</strong></td>
                            <td><span class="status-ok">âœ…</span> <code>twse_cache_store</code></td>
                            <td><span class="status-err">âŒ</span> ç„¡æœˆåº¦åˆ†å‰²</td>
                        </tr>
                        <tr>
                            <td><strong>ç¯„åœå¿«å–</strong></td>
                            <td><span class="status-err">âŒ</span></td>
                            <td><span class="status-ok">âœ…</span> <code>us_price_store</code></td>
                        </tr>
                        <tr>
                            <td><strong>CDN TTL (æ­·å²)</strong></td>
                            <td>1 å¹´</td>
                            <td>1 å¹´</td>
                        </tr>
                        <tr>
                            <td><strong>CDN TTL (ç•¶å‰)</strong></td>
                            <td>1 å°æ™‚</td>
                            <td>1 å°æ™‚</td>
                        </tr>
                        <tr>
                            <td><strong>Blob TTL</strong></td>
                            <td>24-72 å°æ™‚</td>
                            <td>12 å°æ™‚</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section>
            <h2>å…­ã€é—œéµå‡½å¼è·¯å¾‘</h2>

            <h3>6.1 å°è‚¡è³‡æ–™ç²å–è·¯å¾‘</h3>
            <pre><code>Worker (fetchStockData)
    â†“
tryFetchRangeFromBlob()        â†’ stock-range.js â†’ Year Cache
    â†“ (ç¼ºå£æˆ–å¤±æ•—)
fetchMissingRanges()           â†’ twse-proxy.js â†’ Month Cache â†’ TWSE/FinMind/Yahoo
    â†“
recordYearSupersetSlices()     â†’ å¯«å…¥ IndexedDB</code></pre>

            <h3>6.2 ç¾è‚¡è³‡æ–™ç²å–è·¯å¾‘</h3>
            <pre><code>Worker (fetchUSStockData)
    â†“
us-proxy.js
    â†“
readCache()                    â†’ Memory/Blob Cache
    â†“ (æœªå‘½ä¸­)
fetchUSPriceRange()            â†’ FinMind â†’ Yahoo (å‚™æ´)
    â†“
writeCache()                   â†’ Memory + Blob</code></pre>
        </section>

        <section>
            <h2>ä¸ƒã€å¿«å–å¤±æ•ˆèˆ‡æ›´æ–°æ©Ÿåˆ¶</h2>
            <div class="mermaid">
                flowchart TD
                A["æœˆå¿«å–å¯«å…¥æˆåŠŸ"]
                B["triggerYearCacheRefresh()"]
                C["éåŒæ­¥å‘¼å« stock-range.js"]
                D["stock-range é‡è®€æœˆå¿«å–"]
                E["æ›´æ–° Year Cache Blob"]
                F["ä¸‹æ¬¡è«‹æ±‚å‘½ä¸­ Year Cache"]

                A --> B --> C --> D --> E --> F
            </div>

            <h3>å¿«å–å¤±æ•ˆè§¸ç™¼æ¢ä»¶</h3>
            <ul>
                <li><strong>TTL éæœŸ</strong>: è¶…éè¨­å®šçš„å­˜æ´»æ™‚é–“è‡ªå‹•å¤±æ•ˆ</li>
                <li><strong>æœˆå¿«å–æ›´æ–°</strong>: æœˆåº¦è³‡æ–™æ›´æ–°å¾Œè§¸ç™¼å¹´åº¦å¿«å–é‡å»º</li>
                <li><strong>æ‰‹å‹• cacheBust</strong>: URL åƒæ•¸å¯å¼·åˆ¶ç¹éå¿«å–</li>
                <li><strong>ç•¶æ—¥è³‡æ–™ç­–ç•¥</strong>: å°ç£æ™‚é–“ 14:00 å¾Œæª¢æŸ¥ç•¶æ—¥è³‡æ–™</li>
            </ul>
        </section>

        <section>
            <h2>å…«ã€è¨­è¨ˆå„ªå‹¢</h2>
            <ul>
                <li><strong>å¤šå±¤å¿«å–æ¥µè‡´å„ªåŒ–</strong>
                    <ul>
                        <li>ç€è¦½å™¨æœ¬åœ° â†’ CDN é‚Šç·£ â†’ Blob å„²å­˜ â†’ å¤–éƒ¨ API</li>
                        <li>æ­·å²è³‡æ–™å¹¾ä¹é›¶æµé‡æ¶ˆè€—</li>
                    </ul>
                </li>
                <li><strong>æ™ºèƒ½å‚™æ´æ©Ÿåˆ¶</strong>
                    <ul>
                        <li>å°è‚¡: TWSE â†’ FinMind â†’ Yahoo</li>
                        <li>ç¾è‚¡: FinMind â†’ Yahoo</li>
                        <li>ä»»ä¸€ä¾†æºå¤±æ•—è‡ªå‹•åˆ‡æ›</li>
                    </ul>
                </li>
                <li><strong>å‹•æ…‹ TTL ç­–ç•¥</strong>
                    <ul>
                        <li>æ­·å²è³‡æ–™è¨­å®š <code>immutable</code>ï¼ŒCDN æ¥µé•·å¿«å–</li>
                        <li>ç•¶å‰è³‡æ–™ 1 å°æ™‚æ›´æ–°ï¼Œå¹³è¡¡æ–°é®®åº¦èˆ‡æµé‡</li>
                    </ul>
                </li>
                <li><strong>Year Cache èšåˆ</strong>
                    <ul>
                        <li>å°‡æœˆåº¦è³‡æ–™èšåˆç‚ºå¹´åº¦ï¼Œæ¸›å°‘ API å‘¼å«æ¬¡æ•¸</li>
                        <li>ä¸€æ¬¡è«‹æ±‚ç²å–æ•´å¹´è³‡æ–™</li>
                    </ul>
                </li>
            </ul>
        </section>

        <footer>
            <p>Generated by LazyBacktest AI â€¢ 2025</p>
        </footer>
    </div>

    <script>
        // Init Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            securityLevel: 'loose',
            fontFamily: 'Inter',
        });
    </script>
</body>

</html>