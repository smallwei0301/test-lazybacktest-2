# LazyBacktest 分層架構說明

這個目錄包含重構後的模組化分層架構，將原本的巨型檔案拆分成清晰的功能層級。

## 目錄結構

```
js/layers/
├── api/              API 層 - 處理外部資料來源
├── core/             核心計算層 - 純邏輯運算
│   └── indicators/   技術指標計算模組
├── ui/               使用者介面層 - DOM 操作與狀態管理
├── strategy/         策略系統層 - 交易策略邏輯
└── ai/               AI 計算層 - 機器學習與預測
```

## 分層原則

### 1. **API 層** (`api/`)
- **職責**: 統一管理外部 API 呼叫、快取、錯誤處理
- **不依賴**: UI 層
- **可被依賴**: 核心層、UI 層

### 2. **核心計算層** (`core/`)
- **職責**: 純邏輯運算，技術指標、回測引擎、風險管理
- **不依賴**: UI 層、API 層
- **可被依賴**: 所有其他層

### 3. **UI 層** (`ui/`)
- **職責**: DOM 操作、事件處理、狀態管理、視覺化
- **依賴**: API 層、核心層
- **不可被依賴**: 其他層不應直接依賴 UI

### 4. **策略層** (`strategy/`)
- **職責**: 交易策略邏輯、外掛系統管理
- **依賴**: 核心層
- **可被依賴**: UI 層、AI 層

### 5. **AI 層** (`ai/`)
- **職責**: 機器學習模型、預測算法、TensorFlow.js
- **依賴**: 核心層、策略層
- **可被依賴**: UI 層

## 重構進度

- [x] 建立基礎目錄結構
- [ ] 提取技術指標到 `core/indicators/`
- [ ] 建立狀態管理器在 `ui/`
- [ ] 提取 API 客戶端到 `api/`
- [ ] 重構回測引擎到 `core/`
- [ ] 整理策略系統到 `strategy/`
- [ ] 分離 AI 模組到 `ai/`

## 模組載入約定

每個層級應該：
1. 導出清晰的 API 介面
2. 不直接修改全域變數
3. 使用 ES6 模組語法 (如果適用)
4. 提供完整的 JSDoc 註解
5. 包含對應的單元測試

---

**注意**: 這個重構過程遵循 TDD 原則，每個模組都會先建立測試再實作功能。