
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ˆ LazyBacktest - å°è‚¡å›æ¸¬ç³»çµ± v0.1.1</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VNX2RVHZ5K"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-VNX2RVHZ5K');
    </script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <link rel="stylesheet" href="css/style.css">
    <style>
      :root {
        --background: #ffffff;
        --foreground: #4b5563;
        --card: #f9fafb;
        --card-foreground: #374151;
        --popover: #ffffff;
        --popover-foreground: #4b5563;
        --primary: #0891b2;
        --primary-foreground: #ffffff;
        --secondary: #f59e0b;
        --secondary-foreground: #ffffff;
        --muted: #b0b0b0;
        --muted-foreground: #4b5563;
        --accent: #f59e0b;
        --accent-foreground: #ffffff;
        --destructive: #dc2626;
        --destructive-foreground: #ffffff;
        --border: #e5e7eb;
        --input: #ffffff;
        --ring: rgba(8, 145, 178, 0.5);
        --radius: 0.5rem;
      }
      
      .card {
        background-color: var(--card);
        color: var(--card-foreground);
        border-radius: calc(var(--radius) + 2px);
        border: 1px solid var(--border);
        box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      }
      
      .card-header {
        padding: 1.5rem 1.5rem 0 1.5rem;
      }
      
      .card-content {
        padding: 1.5rem;
      }
      
      .card-title {
        font-weight: 600;
        line-height: 1;
        margin-bottom: 0.375rem;
        font-size: 1.125rem; /* 18px - ç¢ºä¿æ¨™é¡Œæ¯”å…§å®¹å¤§ */
      }
      
      /* èª¿æ•´äº¤æ˜“è¨˜éŒ„çš„å­—é«”å¤§å°å’Œæ¨£å¼ */
      #trade-results {
        width: 100%;
      }
      
      .trade-list {
        width: 100%;
        background-color: var(--background);
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        overflow: visible !important; /* å¼·åˆ¶å–æ¶ˆæ»¾å‹•ï¼Œé¡¯ç¤ºæ‰€æœ‰å…§å®¹ */
        overflow-x: visible !important;
        overflow-y: visible !important;
        height: auto !important; /* å¼·åˆ¶è‡ªå‹•é«˜åº¦ */
        max-height: none !important; /* å¼·åˆ¶ç§»é™¤æœ€å¤§é«˜åº¦é™åˆ¶ */
        min-height: auto !important; /* å¼·åˆ¶ç§»é™¤æœ€å°é«˜åº¦é™åˆ¶ */
      }
      
      .trade-list .trade-signal {
        font-size: 0.875rem;
        padding: 1.25rem 1.5rem; /* å¢åŠ ä¸Šä¸‹å·¦å³çš„ padding */
        border-bottom: 1px solid var(--border);
        background-color: var(--card);
        transition: all 0.15s ease;
        margin-bottom: 0.5rem; /* å¢åŠ é …ç›®é–“è· */
      }
      
      .trade-list .trade-signal:hover {
        background-color: var(--muted);
      }
      
      .trade-list .trade-signal:last-child {
        border-bottom: none;
      }
      
      .trade-list .trade-signal .text-xs {
        font-size: 0.75rem !important;
        line-height: 1.4;
      }
      
      .trade-list .trade-signal .text-sm {
        font-size: 0.875rem !important;
        line-height: 1.4;
        font-weight: 500;
      }
      
      .trade-list .trade-signal .text-base {
        font-size: 1rem !important;
        line-height: 1.4;
      }
      
      /* äº¤æ˜“æ“ä½œæ¨™ç±¤æ¨£å¼ */
      .trade-action {
        font-size: 0.75rem !important;
        font-weight: 600;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        white-space: nowrap;
      }
      
      /* æç¤ºå€åŸŸæ¨£å¼ */
      #trade-hints, #trade-hints-mobile {
        font-size: 0.75rem;
        line-height: 1.5;
      }
      
      #trade-hints p, #trade-hints-mobile p {
        margin-bottom: 0.5rem;
        line-height: 1.5;
      }
      
      #trade-hints p:last-child, #trade-hints-mobile p:last-child {
        margin-bottom: 0;
      }
      
      /* ç¨ç«‹æ»¾å‹•å€åŸŸæ¨£å¼ */
      @media (min-width: 1024px) {
        .lg\\:h-screen {
          height: calc(100vh - 12rem); /* æ¸›å»headerå’Œpaddingé«˜åº¦ */
        }
        
        /* å·¦å´é¢æ¿æ»¾å‹•æ¨£å¼ */
        .lg\\:overflow-y-auto:first-child {
          padding-right: 0.5rem;
        }
        
        /* å³å´é¢æ¿æ»¾å‹•æ¨£å¼ */
        .lg\\:overflow-y-auto:last-child {
          padding-left: 0.5rem;
        }
        
        /* Webkitæ»¾å‹•æ¢æ¨£å¼ */
        .lg\\:overflow-y-auto::-webkit-scrollbar {
          width: 8px;
        }
        
        .lg\\:overflow-y-auto::-webkit-scrollbar-track {
          background: var(--muted);
          border-radius: 4px;
        }
        
        .lg\\:overflow-y-auto::-webkit-scrollbar-thumb {
          background: var(--border);
          border-radius: 4px;
          transition: background 0.2s ease;
        }
        
        .lg\\:overflow-y-auto::-webkit-scrollbar-thumb:hover {
          background: var(--muted-foreground);
        }
        
        /* Firefoxæ»¾å‹•æ¢æ¨£å¼ */
        .lg\\:overflow-y-auto {
          scrollbar-width: thin;
          scrollbar-color: var(--border) var(--muted);
        }
        
        /* é˜²æ­¢æ©«å‘æ»¾å‹•ä¸¦ç¢ºä¿å¯¬åº¦é™åˆ¶ */
        .main-grid {
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .main-grid > * {
          min-width: 0;
          overflow-x: hidden;
        }
        
        /* å·¦å´é¢æ¿æ¨£å¼ */
        .left-panel {
          padding-right: 0.75rem; /* å·¦å´é¢æ¿å³é‚Šè· */
        }
        
        .left-panel::-webkit-scrollbar {
          width: 8px;
        }
        
        .left-panel::-webkit-scrollbar-track {
          margin-right: 8px; /* æ»¾å‹•è»¸è»Œé“å³å´ç•™ç™½ */
        }
        
        /* å³å´é¢æ¿æ¨£å¼ */
        .right-panel {
          padding-right: 2rem; /* å¢åŠ å³å´å…§è·é¿å…å¡ç‰‡è¢«è£æ–· */
          padding-left: 0.75rem; /* å³å´é¢æ¿å·¦é‚Šè· */
        }
        
        /* å³å´é¢æ¿å…§çš„å¡ç‰‡å’Œå…§å®¹ç¢ºä¿ä¸è¢«è£æ–· */
        .right-panel .card {
          max-width: 100%;
          margin-right: 0;
        }
        
        .right-panel .card-content {
          padding-right: 1.5rem;
        }
        
        /* Sticky æ¨™é¡Œæ¨£å¼ - åªå°å°èˆªæ¨™ç±¤ç”Ÿæ•ˆ */
        .sticky-header {
          position: sticky;
          top: 0;
          z-index: 20;
          background-color: var(--background);
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          margin-bottom: 1.5rem;
        }
        
        /* ç¢ºä¿ sticky header åœ¨æ»¾å‹•å®¹å™¨ä¸­æ­£ç¢ºé¡¯ç¤º */
        .sticky-header .card-header {
          background-color: var(--card);
          border-bottom: 1px solid var(--border);
        }
        
        /* ç¢ºä¿æ¨™ç±¤å…§å®¹å€åŸŸæœ‰è¶³å¤ ç©ºé–“ï¼Œé¿å…è¢« sticky header é®æ“‹ */
        .tab-content {
          padding-top: 0;
        }
        
        /* ç§»é™¤æ¨™ç±¤å…§å®¹å¡ç‰‡çš„ sticky è¨­å®šï¼Œé¿å…æ»¾å‹•è¡çª */
        .tab-content .card {
          position: static; /* ç¢ºä¿æ‰€æœ‰å¡ç‰‡æ­£å¸¸æ»¾å‹• */
          z-index: auto;
        }
        
        .tab-content .card-header {
          background-color: var(--card);
          border-bottom: 1px solid var(--border);
        }
        
        /* äº¤æ˜“ç´€éŒ„å¡ç‰‡ç‰¹æ®Šé«˜åº¦è¨­å®š */
        #trade-results {
          min-height: 900px; /* åŸä¾† 300px çš„ä¸‰å€ */
        }
      }
      
      /* éŸ¿æ‡‰å¼èª¿æ•´ */
      @media (max-width: 1023px) {
        .grid.grid-cols-1.lg\\:grid-cols-12 {
          grid-template-columns: 1fr;
        }
      }
      
      .card-description {
        color: var(--muted-foreground);
        font-size: 0.875rem;
      }
      
      .btn-primary {
        background-color: var(--primary);
        color: var(--primary-foreground);
        border: 1px solid var(--primary);
      }
      
      .btn-primary:hover {
        background-color: color-mix(in srgb, var(--primary) 90%, black);
      }
      
      .btn-secondary {
        background-color: var(--secondary);
        color: var(--secondary-foreground);
        border: 1px solid var(--secondary);
      }
      
      .btn-outline {
        background-color: transparent;
        color: var(--foreground);
        border: 1px solid var(--border);
      }
      
      .btn-outline:hover {
        background-color: var(--accent);
        color: var(--accent-foreground);
      }
      
      .text-primary { color: var(--primary); }
      .text-secondary { color: var(--secondary); }
      .text-accent { color: var(--accent); }
      .text-muted { color: var(--muted-foreground); }
      .bg-primary { background-color: var(--primary); }
      .bg-secondary { background-color: var(--secondary); }
      .bg-accent { background-color: var(--accent); }
      .border-primary { border-color: var(--primary); }
      .border-secondary { border-color: var(--secondary); }
      .border-accent { border-color: var(--accent); }
      
      .lucide {
        width: 1.25rem;
        height: 1.25rem;
        stroke-width: 2;
      }
      
      .lucide-sm {
        width: 1rem;
        height: 1rem;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," /> <!-- From UI file -->
</head>
<body class="bg-white group/design-root" style='font-family: Inter, "Noto Sans", sans-serif;'>
    <div class="relative flex size-full min-h-screen flex-col overflow-x-hidden">
        <div class="layout-container flex h-full grow flex-col">
            <header class="border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50 shadow-sm">
                <div class="container mx-auto px-4 h-16 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center shadow-sm">
                            <div class="w-5 h-5 flex flex-col justify-between">
                                <div class="flex justify-between">
                                    <div class="w-1 h-1 bg-primary-foreground rounded-full" style="background-color: var(--primary-foreground);"></div>
                                    <div class="w-1 h-1 bg-primary-foreground rounded-full" style="background-color: var(--primary-foreground);"></div>
                                    <div class="w-1 h-1 bg-primary-foreground rounded-full" style="background-color: var(--primary-foreground);"></div>
                                </div>
                                <div class="flex justify-between items-end">
                                    <div class="w-1 h-2 bg-primary-foreground rounded-sm" style="background-color: var(--primary-foreground);"></div>
                                    <div class="w-1 h-3 bg-primary-foreground rounded-sm" style="background-color: var(--primary-foreground);"></div>
                                    <div class="w-1 h-1 bg-primary-foreground rounded-sm" style="background-color: var(--primary-foreground);"></div>
                                </div>
                            </div>
                        </div>
                        <div>
                                    <span class="text-lg font-bold text-foreground" style="color: var(--foreground);">LazyBacktest</span>
                            <div class="text-xs text-muted" style="color: var(--muted-foreground);">å°è‚¡å›æ¸¬ç³»çµ±</div>
                        </div>
                    </div>
                    <nav class="hidden md:flex items-center space-x-6">
                        <div class="text-sm text-muted" style="color: var(--muted-foreground);">
                            é„‰æ°‘å…§éƒ¨æ¸¬è©¦ç‰ˆ: å»ºè­°äº‹é …èˆ‡ Bugï¼Œè«‹è¯çµ¡ä¿¡ç®±: <a href="mailto:smallwei0301@gmail.com" class="underline hover:text-primary" style="color: var(--foreground);">smallwei0301@gmail.com</a>
                        </div>
                    </nav>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 min-h-screen bg-gradient-to-br from-background via-primary/5 to-accent/5 flex flex-col" style="background: linear-gradient(135deg, var(--background) 0%, color-mix(in srgb, var(--primary) 5%, transparent) 50%, color-mix(in srgb, var(--accent) 5%, transparent) 100%);">
                <!-- Hero Section -->
                <div class="bg-background border-b flex-shrink-0" style="background-color: var(--background); border-color: var(--border);">
                    <div class="container mx-auto px-4 py-12">
                        <div class="text-center flex flex-col items-center gap-8">
                            <div class="space-y-6 max-w-3xl">
                                <h1 class="text-4xl lg:text-5xl font-bold text-foreground" style="color: var(--foreground);">
                                    è‚¡ç¥¨å›æ¸¬å·¥å…·
                                </h1>
                                <p class="text-lg text-muted mx-auto" style="color: var(--muted-foreground);">
                                    é€éæ­·å²æ•¸æ“šé©—è­‰æ‚¨çš„äº¤æ˜“ç­–ç•¥ï¼Œåšå‡ºæ›´æ˜æ™ºçš„æŠ•è³‡æ±ºç­–
                                </p>
                            </div>

                            <div class="flex flex-col sm:flex-row items-center justify-center gap-3 w-full sm:w-auto">
                                <!-- ä¸€éµå›æ¸¬æŒ‰éˆ• -->
                                <button
                                    id="quickBacktestBtn"
                                    class="btn-primary px-8 py-4 text-lg font-semibold rounded-lg transition duration-150 ease-in-out flex items-center justify-center"
                                    style="background-color: var(--primary); color: var(--primary-foreground); border: 1px solid var(--primary);"
                                    aria-label="ä¸€éµå›æ¸¬å°ç©é›»ï¼ˆå¯ç·¨è¼¯ï¼‰"
                                    data-state="idle"
                                >
                                    <i data-lucide="zap" class="lucide mr-3"></i>
                                    <span id="quickBacktestDefaultLabel" class="flex items-center gap-2">
                                        ä¸€éµå›æ¸¬
                                        <span
                                            id="quickBacktestKeyword"
                                            class="quick-backtest-editable"
                                            contenteditable="true"
                                            spellcheck="false"
                                            role="textbox"
                                            aria-live="polite"
                                            aria-label="è¼¸å…¥æƒ³å›æ¸¬çš„è‚¡ç¥¨åç¨±æˆ–ä»£ç¢¼"
                                            tabindex="0"
                                            data-placeholder="è¼¸å…¥è‚¡ç¥¨æˆ–ä»£ç¢¼"
                                        >å°ç©é›»</span>
                                    </span>
                                    <span id="quickBacktestStatusText" class="hidden items-center gap-2 text-base font-semibold"></span>
                                </button>

                                <button
                                    id="developerAreaToggle"
                                    type="button"
                                    class="btn-outline px-6 py-4 text-sm font-semibold rounded-lg transition duration-150 ease-in-out flex items-center justify-center"
                                    style="color: var(--foreground); border: 1px solid var(--border); background-color: var(--input);"
                                    aria-expanded="false"
                                    aria-controls="developerAreaWrapper"
                                >
                                    <i data-lucide="wrench" class="lucide mr-2"></i>
                                    é–‹ç™¼è€…å€åŸŸ
                                </button>
                            </div>

                            <p id="quickBacktestHint" class="quick-backtest-hint text-center sm:text-left">
                                å°‡ä½¿ç”¨ 2330ï¼ˆå°ç©é›»ï¼‰é€²è¡Œä¸€éµå›æ¸¬ã€‚
                            </p>

                            <div
                                id="developerAreaWrapper"
                                class="hidden w-full max-w-4xl text-left mx-auto developer-area-wrapper"
                                aria-hidden="true"
                            >
                                <div class="card hero-developer-card" id="developerAreaCard">
                                    <div class="card-header">
                                        <h3 class="card-title flex items-center gap-2">
                                            <i data-lucide="wrench" class="lucide text-primary" style="color: var(--primary);"></i>
                                            é–‹ç™¼è€…å€åŸŸ
                                        </h3>
                                        <p class="card-description">è¨ºæ–·è³‡æ–™æµç¨‹ã€æ¸¬è©¦ä¾†æºèˆ‡ Blob ç”¨é‡</p>
                                    </div>
                                    <div class="card-content space-y-4">
                                        <div class="space-y-2" id="dataSourceTesterContainer">
                                            <button
                                                id="toggleDataSourceTester"
                                                type="button"
                                                class="px-3 py-2 text-xs font-medium rounded-md border flex items-center gap-1 transition-colors"
                                                style="color: var(--foreground); border-color: var(--border); background-color: var(--background);"
                                            >
                                                <i data-lucide="radar" class="lucide w-4 h-4"></i>
                                                æ¸¬è©¦è³‡æ–™ä¾†æº
                                            </button>
                                            <div id="dataSourceTester" class="hidden border rounded-md bg-white/70 shadow-sm" style="border-color: var(--border);">
                                                <div class="flex items-center justify-between px-3 py-2 border-b" style="border-color: var(--border);">
                                                    <div class="text-[11px] font-medium" id="dataSourceTesterMode" style="color: var(--foreground);"></div>
                                                    <button id="closeDataSourceTester" type="button" class="text-[11px] text-muted-foreground hover:text-foreground transition-colors" style="color: var(--muted-foreground);">é—œé–‰</button>
                                                </div>
                                                <div class="px-3 py-3 space-y-3">
                                                    <div id="dataSourceTesterHint" class="text-[11px] text-muted-foreground" style="color: var(--muted-foreground);"></div>
                                                    <div id="dataSourceTesterButtons" class="flex flex-wrap gap-2"></div>
                                                    <div id="dataSourceTesterResult" class="text-xs hidden"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="space-y-2" id="dataDiagnosticsContainer">
                                            <button
                                                id="toggleDataDiagnostics"
                                                type="button"
                                                class="px-3 py-2 text-xs font-medium rounded-md border flex items-center gap-1 transition-colors"
                                                style="color: var(--foreground); border-color: var(--border); background-color: var(--background);"
                                            >
                                                <i data-lucide="bug" class="lucide w-4 h-4"></i>
                                                è¨ºæ–·è³‡æ–™æš–èº«
                                            </button>
                                            <div id="dataDiagnosticsPanel" class="hidden border rounded-md bg-white/70 shadow-sm" style="border-color: var(--border);">
                                                <div class="flex items-center justify-between px-3 py-2 border-b" style="border-color: var(--border);">
                                                    <div class="text-[11px] font-medium" id="dataDiagnosticsTitle" style="color: var(--foreground);">è³‡æ–™æš–èº«è¨ºæ–·</div>
                                                    <button id="closeDataDiagnostics" type="button" class="text-[11px] text-muted-foreground hover:text-foreground transition-colors" style="color: var(--muted-foreground);">é—œé–‰</button>
                                                </div>
                                                <div class="px-3 py-3 space-y-3 text-[11px]" id="dataDiagnosticsBody">
                                                    <div id="dataDiagnosticsHint" class="text-[11px]" style="color: var(--muted-foreground);">è«‹å…ˆåŸ·è¡Œå›æ¸¬å¾Œï¼Œå†æŸ¥çœ‹æš–èº«èˆ‡å¿«å–è¨ºæ–·è³‡è¨Šã€‚</div>
                                                    <div id="dataDiagnosticsContent" class="hidden space-y-3">
                                                        <div>
                                                            <h5 class="font-medium mb-1" style="color: var(--foreground);">åç¨±èˆ‡æ¸…å–®è³‡è¨Š</h5>
                                                            <div id="dataDiagnosticsName" class="space-y-1"></div>
                                                        </div>
                                                        <div>
                                                            <h5 class="font-medium mb-1" style="color: var(--foreground);">è³‡æ–™æ‘˜è¦</h5>
                                                            <div id="dataDiagnosticsSummary" class="space-y-1"></div>
                                                            <div id="dataDiagnosticsInvalidSamples" class="space-y-1 mt-2"></div>
                                                        </div>
                                                        <div>
                                                            <h5 class="font-medium mb-1" style="color: var(--foreground);">æš–èº«èˆ‡æŒ‡æ¨™è¨­å®š</h5>
                                                            <div id="dataDiagnosticsWarmup" class="space-y-1"></div>
                                                        </div>
                                                        <div>
                                                            <h5 class="font-medium mb-1" style="color: var(--foreground);">ä½¿ç”¨è€…èµ·é»é„°è¿‘æ¨£æœ¬</h5>
                                                            <div id="dataDiagnosticsPreview" class="space-y-1"></div>
                                                        </div>
                                                        <div>
                                                            <h5 class="font-medium mb-1" style="color: var(--foreground);">è²·å…¥æŒæœ‰æª¢æŸ¥</h5>
                                                            <div id="dataDiagnosticsBuyHold" class="space-y-1"></div>
                                                            <div id="dataDiagnosticsBuyHoldSamples" class="space-y-1 mt-2"></div>
                                                        </div>
                                                        <div>
                                                            <h5 class="font-medium mb-1" style="color: var(--foreground);">æœˆåº¦æŠ“å–ç´€éŒ„</h5>
                                                            <div id="dataDiagnosticsFetchSummary" class="space-y-1"></div>
                                                            <div id="dataDiagnosticsFetchMonths" class="space-y-2 mt-2"></div>
                                                        </div>
                                                        <div>
                                                            <h5 class="font-medium mb-1" style="color: var(--foreground);">æ‰‹å‹•æ¸¬è©¦æŒ‡å¼•</h5>
                                                            <div id="dataDiagnosticsTesting" class="space-y-1"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="space-y-2" id="dataSourceSummaryContainer">
                                            <div class="flex items-center justify-between">
                                                <div class="text-sm font-medium flex items-center gap-2" style="color: var(--foreground);">
                                                    <i data-lucide="layers" class="lucide w-4 h-4"></i>
                                                    æ•¸æ“šä¾†æºæ‘˜è¦
                                                </div>
                                                <span id="dataSourceSummaryTag" class="text-[11px] text-muted-foreground" style="color: var(--muted-foreground);"></span>
                                            </div>
                                            <div class="rounded-md border bg-white/70 shadow-sm" style="border-color: var(--border);">
                                                <div id="dataSourceDisplay" class="px-3 py-3 space-y-2 text-[11px]" style="color: var(--foreground);"></div>
                                            </div>
                                        </div>
                                        <div class="space-y-2" id="todaySuggestionLogContainer">
                                            <div class="flex items-center justify-between">
                                                <div class="text-sm font-medium flex items-center gap-2" style="color: var(--foreground);">
                                                    <i data-lucide="message-square-warning" class="lucide w-4 h-4"></i>
                                                    ä»Šæ—¥å»ºè­°è¨˜éŒ„
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <button
                                                        id="todaySuggestionLogToggle"
                                                        type="button"
                                                        class="px-2 py-1 text-[11px] rounded-md border transition-colors flex items-center gap-1"
                                                        style="color: var(--foreground); border-color: var(--border); background-color: var(--background);"
                                                        aria-expanded="false"
                                                        aria-controls="todaySuggestionLogPanel"
                                                    >
                                                        <span class="toggle-indicator">ï¼‹</span>
                                                        <span class="toggle-label">å±•é–‹</span>
                                                    </button>
                                                    <button
                                                        id="todaySuggestionLogClear"
                                                        type="button"
                                                        class="px-2 py-1 text-[11px] rounded-md border transition-colors"
                                                        style="color: var(--muted-foreground); border-color: var(--border); background-color: var(--background);"
                                                    >
                                                        æ¸…é™¤ç´€éŒ„
                                                    </button>
                                                </div>
                                            </div>
                                            <div
                                                id="todaySuggestionLogPanel"
                                                class="rounded-md border bg-white/70 shadow-sm hidden"
                                                style="border-color: var(--border);"
                                                aria-hidden="true"
                                            >
                                                <div
                                                    id="today-suggestion-log-body"
                                                    class="px-3 py-3 space-y-3 text-[11px]"
                                                    style="color: var(--foreground);"
                                                ></div>
                                            </div>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex items-center justify-between">
                                                <div class="text-sm font-medium flex items-center gap-2" style="color: var(--foreground);">
                                                    <i data-lucide="database" class="lucide w-4 h-4"></i>
                                                    Blob ä½¿ç”¨ç›£æ§
                                                </div>
                                                <div id="blobUsageUpdatedAt" class="text-[11px]" style="color: var(--muted-foreground);"></div>
                                            </div>
                                            <div class="rounded-md border bg-white/70 shadow-sm" style="border-color: var(--border);">
                                                <div id="blobUsageContent" class="px-3 py-3 space-y-3 text-[11px]" style="color: var(--foreground);"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container mx-auto px-4 py-8 flex-1 overflow-hidden">
                    <div class="main-grid h-full overflow-hidden overflow-x-hidden">
                        <!-- Left Panel - Settings and Controls -->
                        <div class="space-y-6 lg:overflow-y-auto lg:h-screen lg:sticky lg:top-0 lg:pb-8 overflow-x-hidden left-panel" style="scrollbar-width: thin; scrollbar-color: var(--muted) var(--background);">

                            <!-- Settings Cards -->
                            <div class="space-y-6">
                                <!-- Basic Settings Card -->
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title flex items-center gap-2">
                                            <i data-lucide="settings" class="lucide text-primary" style="color: var(--primary);"></i>
                                            <span class="tooltip">
                                                åŸºæœ¬è¨­å®š
                                                <span class="tooltiptext">æ›´æ”¹ä»£ç¢¼æˆ–æ—¥æœŸç¯„åœæœƒè§¸ç™¼é‡æ–°ç²å–æ•¸æ“šã€‚</span>
                                            </span>
                                        </h3>
                                        <p class="card-description">è¨­å®šè‚¡ç¥¨ä»£ç¢¼ã€æ™‚é–“ç¯„åœå’Œåˆå§‹è³‡é‡‘</p>
                                    </div>
                                    <div class="card-content space-y-4">
                                        <div>
                                            <label for="stockNo" class="block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">å°ç£/ç¾åœ‹è‚¡ç¥¨ä»£ç¢¼ (ç›®å‰ç„¡æä¾›æŒ‡æ•¸)</label>
                                            <div class="flex flex-wrap items-center gap-2">
                                                <div class="flex-1 min-w-[160px] sm:min-w-[200px]">
                                                    <input
                                                        id="stockNo"
                                                        type="text"
                                                        value="2330"
                                                        placeholder="ä¾‹å¦‚: 2330, 0050, AAPL"
                                                        class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm"
                                                        style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                    />
                                                </div>
                                                <div class="flex items-center gap-2 text-xs shrink-0 min-w-[150px]">
                                                    <span class="text-muted-foreground" style="color: var(--muted-foreground);">å¸‚å ´:</span>
                                                    <select
                                                        id="marketSelect"
                                                        class="px-3 py-1 border border-border rounded-md text-xs bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring pr-8"
                                                        style="border-color: var(--border); background-color: var(--input); color: var(--foreground); min-width: 6.5rem;"
                                                    >
                                                        <option value="TWSE">ä¸Šå¸‚</option>
                                                        <option value="TPEX">ä¸Šæ«ƒ</option>
                                                        <option value="US">ç¾è‚¡</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div id="marketAdjustedHint" class="mt-1 text-[11px] text-amber-600 hidden">
                                                ç¾è‚¡å›æ¸¬ç›®å‰æ¡ç”¨åŸå§‹è‚¡åƒ¹ï¼Œå·²è‡ªå‹•åœç”¨é™¤æ¬Šæ¯é‚„åŸèˆ‡æ‹†åˆ†é¸é …ã€‚
                                            </div>
                                            <div id="stockNameDisplay" class="mt-1 text-xs" style="display: none;">
                                                <!-- è‚¡ç¥¨åç¨±å’Œå¸‚å ´åˆ‡æ›æç¤ºå°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
                                            </div>
                                            <div
                                                id="pricePipelineSteps"
                                                class="mt-1 hidden space-y-1"
                                                style="color: var(--muted-foreground);"
                                            ></div>
                            </div>
                            <!-- Patch Tag: LB-ADJ-SWITCH-20240922A -->
                                        <!-- Patch Tag: LB-ADJ-SPLIT-20250518A -->
                                        <div class="flex items-center gap-4">
                                            <div class="flex items-center">
                                                <input type="checkbox" id="adjustedPriceCheckbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded mr-2" />
                                                <label for="adjustedPriceCheckbox" class="text-xs text-muted" style="color: var(--muted-foreground);">é™¤æ¬Šæ¯é‚„åŸè‚¡åƒ¹</label>
                                            </div>
                                            <div class="flex items-center">
                                                <input type="checkbox" id="splitAdjustmentCheckbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded mr-2" />
                                                <label for="splitAdjustmentCheckbox" class="text-xs text-muted" style="color: var(--muted-foreground);">è‚¡ç¥¨æ‹†åˆ†é‚„åŸ</label>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label for="startDate" class="block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">é–‹å§‹æ—¥æœŸ</label>
                                                <input 
                                                    type="date" 
                                                    id="startDate" 
                                                    class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm"
                                                    style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                />
                                            </div>
                                            <div>
                                                <label for="endDate" class="block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">çµæŸæ—¥æœŸ</label>
                                                <input 
                                                    type="date" 
                                                    id="endDate" 
                                                    class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm"
                                                    style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                />
                                            </div>
                                        </div>
                                        <div class="flex items-end gap-2">
                                            <div class="flex-grow">
                                                <label for="recentYears" class="block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">æœ€è¿‘Nå¹´</label>
                                                <input 
                                                    type="number" 
                                                    id="recentYears" 
                                                    value="5" 
                                                    min="1" 
                                                    max="50" 
                                                    step="1" 
                                                    class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm"
                                                    style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                />
                                            </div>
                                            <button id="applyYearsBtn" title="è¨­å®šé–‹å§‹æ—¥æœŸ" class="px-3 py-2 bg-primary hover:bg-primary text-white text-xs rounded-md transition duration-150 ease-in-out whitespace-nowrap" style="background-color: var(--primary);">å¥—ç”¨</button>
                                        </div>
                                        <div>
                                            <label for="initialCapital" class="block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">åˆå§‹æœ¬é‡‘ (å…ƒ)</label>
                                            <input 
                                                type="number" 
                                                id="initialCapital" 
                                                value="100000" 
                                                step="1000" 
                                                class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm"
                                                style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                            />
                                        </div>
                                    </div>
                                </div>
                                <!-- Trading Settings Card -->
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title flex items-center gap-2">
                                            <i data-lucide="trending-up" class="lucide text-accent" style="color: var(--accent);"></i>
                                            äº¤æ˜“è¨­å®š
                                        </h3>
                                        <p class="card-description">è¨­å®šäº¤æ˜“æ™‚æ©Ÿå’Œæ‰‹çºŒè²»</p>
                                    </div>
                                    <div class="card-content">
                                        <div class="space-y-3 mb-4 pb-3 border-b" style="border-color: var(--border);">
                                            <p class="text-xs font-medium text-foreground" style="color: var(--foreground);">è²·è³£æ™‚é–“é»</p>
                                            <div class="flex items-center">
                                                <input type="radio" id="tradeTimingClose" name="tradeTiming" value="close" checked class="h-4 w-4 text-accent border-border focus:ring-accent mr-2" style="border-color: var(--border); color: var(--accent);">
                                                <label for="tradeTimingClose" class="tooltip text-xs text-foreground" style="color: var(--foreground);">
                                                    ç•¶æ—¥ (N) æ”¶ç›¤åƒ¹
                                                    <span class="tooltiptext">ä½¿ç”¨ä¿¡è™Ÿç”¢ç”Ÿç•¶æ—¥çš„æ”¶ç›¤åƒ¹äº¤æ˜“ã€‚</span>
                                                </label>
                                            </div>
                                            <div class="flex items-center">
                                                <input type="radio" id="tradeTimingOpen" name="tradeTiming" value="open" class="h-4 w-4 text-accent border-border focus:ring-accent mr-2" style="border-color: var(--border); color: var(--accent);">
                                                <label for="tradeTimingOpen" class="tooltip text-xs text-foreground" style="color: var(--foreground);">
                                                    éš”æ—¥ (N+1) é–‹ç›¤åƒ¹
                                                    <span class="tooltiptext">ä½¿ç”¨ä¿¡è™Ÿç”¢ç”Ÿæ¬¡æ—¥çš„é–‹ç›¤åƒ¹äº¤æ˜“ã€‚</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="space-y-4">
                                            <p class="text-xs font-medium text-foreground" style="color: var(--foreground);">äº¤æ˜“æˆæœ¬è¨­å®š (%)</p>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label for="buyFee" class="tooltip block text-xs font-medium text-muted mb-1" style="color: var(--muted-foreground);">
                                                        è²·å…¥æ‰‹çºŒè²» (%)
                                                        <span class="tooltiptext">é è¨­æœƒæ ¹æ“šè‚¡ç¥¨/ETFä»£ç¢¼è‡ªå‹•åˆ¤æ–·ã€‚ä¸€èˆ¬è‚¡ç¥¨ç‚º0.1425%ï¼ŒETF é€šå¸¸ç‚º 0.1% (ä½†ä¾åˆ¸å•†å¯èƒ½ä¸åŒ)ã€‚å¯è‡ªè¡Œä¿®æ”¹ã€‚</span>
                                                    </label>
                                                    <input type="number" id="buyFee" value="0.1425" min="0" max="5" step="0.0001" class="w-full px-2 py-1 border border-border rounded-md shadow-sm text-sm focus:ring-accent focus:border-accent bg-input text-foreground" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);">
                                                </div>
                                                <div>
                                                    <label for="sellFee" class="tooltip block text-xs font-medium text-muted mb-1" style="color: var(--muted-foreground);">
                                                        è³£å‡ºæ‰‹çºŒè²»+ç¨… (%)
                                                        <span class="tooltiptext">é è¨­æœƒæ ¹æ“šä»£ç¢¼è‡ªå‹•åˆ¤æ–·ã€‚ä¸€èˆ¬è‚¡ç¥¨ç‚º 0.1425% æ‰‹çºŒè²» + 0.3% äº¤æ˜“ç¨… = 0.4425%ã€‚ETF ç‚º 0.1% æ‰‹çºŒè²» + 0.1% äº¤æ˜“ç¨… = 0.2%ã€‚å¯è‡ªè¡Œä¿®æ”¹ã€‚</span>
                                                    </label>
                                                    <input type="number" id="sellFee" value="0.4425" min="0" max="5" step="0.0001" class="w-full px-2 py-1 border border-border rounded-md shadow-sm text-sm focus:ring-accent focus:border-accent bg-input text-foreground" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Risk Management Card -->
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title flex items-center gap-2">
                                            <i data-lucide="shield" class="lucide text-destructive" style="color: var(--destructive);"></i>
                                            é¢¨éšªç®¡ç†
                                        </h3>
                                        <p class="card-description">è¨­å®šéƒ¨ä½å¤§å°å’Œåœæåœåˆ© (å¤šç©ºå…±ç”¨)</p>
                                    </div>
                                    <div class="card-content space-y-4">
                                        <div class="space-y-2">
                                            <label class="tooltip block text-xs font-medium text-foreground" style="color: var(--foreground);">
                                                éƒ¨ä½å¤§å°è¨ˆç®—åŸºæº–
                                                <span class="tooltiptext">é¸æ“‡æ¯æ¬¡é€²å ´æ™‚ï¼Œç”¨æ–¼è¨ˆç®—æŠ•å…¥é‡‘é¡çš„åŸºæº–ï¼š<br>- åˆå§‹æœ¬é‡‘ï¼šå›ºå®šä½¿ç”¨æœ€é–‹å§‹è¨­å®šçš„æœ¬é‡‘è¨ˆç®—éƒ¨ä½å¤§å°ã€‚<br>- ç¸½è³‡é‡‘ï¼šä½¿ç”¨ç•¶ä¸‹æ¨¡æ“¬å¸³æˆ¶çš„ç¸½è³‡ç”¢ (åŒ…å«å·²å¯¦ç¾æç›Š) è¨ˆç®—éƒ¨ä½å¤§å°ï¼Œéƒ¨ä½æœƒéš¨è‘—ç²åˆ©æ”¾å¤§æˆ–è™§æç¸®å° (è¤‡åˆ©æ•ˆæœ)ã€‚</span>
                                            </label>
                                            <div class="flex items-center gap-4">
                                                <div class="flex items-center">
                                                    <input type="radio" id="positionBasisInitial" name="positionBasis" value="initialCapital" checked class="h-4 w-4 text-accent border-border focus:ring-accent mr-1" style="border-color: var(--border); color: var(--accent);">
                                                    <label for="positionBasisInitial" class="text-xs text-foreground" style="color: var(--foreground);">åˆå§‹æœ¬é‡‘</label>
                                                </div>
                                                <div class="flex items-center">
                                                    <input type="radio" id="positionBasisTotal" name="positionBasis" value="totalCapital" class="h-4 w-4 text-accent border-border focus:ring-accent mr-1" style="border-color: var(--border); color: var(--accent);">
                                                    <label for="positionBasisTotal" class="text-xs text-foreground" style="color: var(--foreground);">ç¸½è³‡é‡‘</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label for="positionSize" class="tooltip block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">
                                                éƒ¨ä½å¤§å° (%)
                                                <span class="tooltiptext">å–®æ¬¡é€²å ´ä½¿ç”¨çš„ **è¨ˆç®—åŸºæº–** (ä¸Šæ–¹é¸æ“‡) çš„ç™¾åˆ†æ¯” (å¤šç©ºç¨ç«‹è¨ˆç®—)ã€‚</span>
                                            </label>
                                            <input type="number" id="positionSize" value="100" min="1" max="100" class="w-full px-3 py-2 border border-border rounded-md shadow-sm text-sm focus:ring-accent focus:border-accent bg-input text-foreground" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);">
                                        </div>

                                        <div class="space-y-2" id="multiStagePanel">
                                            <div class="flex items-center gap-2">
                                                <span class="text-xs font-medium text-foreground" style="color: var(--foreground);">å¤šæ¬¡é€²å‡ºå ´</span>
                                                <button
                                                    type="button"
                                                    id="multiStageToggle"
                                                    class="flex h-6 w-6 items-center justify-center rounded-full border border-border text-xs font-semibold leading-none transition-colors"
                                                    style="border-color: var(--border); color: var(--foreground);"
                                                    aria-label="åˆ‡æ›å¤šæ¬¡é€²å‡ºå ´è¨­å®š"
                                                    aria-expanded="false"
                                                    aria-controls="multiStageContent"
                                                >
                                                    <span id="multiStageToggleIcon" aria-hidden="true">+</span>
                                                </button>
                                            </div>
                                            <div
                                                id="multiStageContent"
                                                class="hidden space-y-3 border-t border-border pt-3"
                                                style="border-color: var(--border);"
                                            >
                                                <div class="space-y-3" id="stagedEntryContainer">
                                                    <div class="space-y-2">
                                                        <div class="flex items-center justify-between">
                                                            <label class="block text-xs font-medium" style="color: var(--foreground);">
                                                                åˆ†æ®µé€²å ´ (%)
                                                            </label>
                                                            <button type="button" id="addEntryStageButton" class="text-xs font-medium px-2 py-1 rounded border transition-colors" style="border-color: var(--border); color: var(--accent);">
                                                                æ–°å¢åˆ†æ®µ
                                                            </button>
                                                        </div>
                                                        <p class="text-[11px] leading-snug" style="color: var(--muted-foreground);">
                                                            é è¨­èˆ‡ä¸Šæ–¹éƒ¨ä½å¤§å°åŒæ­¥ã€‚æ–°å¢åˆ†æ®µå¾Œå¯ä¾åºè¨­å®šä¸åŒç™¾åˆ†æ¯”ï¼Œä¾‹å¦‚ 50%ã€60%ï¼Œç³»çµ±å°‡ä¾ç…§è§¸ç™¼é †åºåˆ†æ‰¹æŠ•å…¥ã€‚
                                                        </p>
                                                        <div id="entryStageList" class="space-y-2"></div>
                                                    </div>
                                                    <div class="space-y-1.5">
                                                        <label for="entryStagingMode" class="block text-xs font-medium" style="color: var(--foreground);">
                                                            åˆ†æ®µè§¸ç™¼æ¢ä»¶
                                                        </label>
                                                        <select
                                                            id="entryStagingMode"
                                                            class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-xs"
                                                            style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                        >
                                                            <option value="signal_repeat">ç­–ç•¥è¨Šè™Ÿå†è§¸ç™¼ï¼ˆæœ‰æ¢ä»¶è²·ï¼‰</option>
                                                            <option value="price_pullback">åƒ¹æ ¼å›è½åŠ ç¢¼ï¼ˆæ›´ä¾¿å®œè²·ï¼‰</option>
                                                        </select>
                                                        <p class="text-[11px] leading-snug" style="color: var(--muted-foreground);">
                                                            ã€Œåƒ¹æ ¼å›è½åŠ ç¢¼ã€æœƒåœ¨é¦–æ¬¡é€²å ´å¾Œã€æ”¶ç›¤åƒ¹è·Œç ´å‰ä¸€æ®µçš„æˆäº¤åƒ¹æ™‚è‡ªå‹•æŠ•å…¥ä¸‹ä¸€æ®µï¼›ã€Œç­–ç•¥è¨Šè™Ÿå†è§¸ç™¼ã€å‰‡éœ€ç­–ç•¥æ¢ä»¶å†æ¬¡æˆç«‹æ‰æœƒåŠ ç¢¼ã€‚
                                                        </p>
                                                    </div>
                                                    <div class="space-y-3" id="stagedExitContainer">
                                                        <div class="space-y-2">
                                                            <div class="flex items-center justify-between">
                                                                <label class="block text-xs font-medium" style="color: var(--foreground);">
                                                                    åˆ†æ®µå‡ºå ´ (%)
                                                                </label>
                                                                <button type="button" id="addExitStageButton" class="text-xs font-medium px-2 py-1 rounded border transition-colors" style="border-color: var(--border); color: var(--accent);">
                                                                    æ–°å¢åˆ†æ®µ
                                                                </button>
                                                            </div>
                                                            <p class="text-[11px] leading-snug" style="color: var(--muted-foreground);">
                                                                é è¨­ä¸€æ¬¡å‡ºæ¸…ã€‚æ–°å¢åˆ†æ®µå¾Œå¯ä¾åºè¨­å®šéƒ¨åˆ†ç²åˆ©ï¼Œä¾‹å¦‚ 40%ã€30%ã€30%ï¼Œç³»çµ±æœƒæŒ‰ç…§è§¸ç™¼é †åºåˆ†æ‰¹å‡ºå ´ã€‚
                                                            </p>
                                                            <div id="exitStageList" class="space-y-2"></div>
                                                        </div>
                                                        <div class="space-y-1.5">
                                                            <label for="exitStagingMode" class="block text-xs font-medium" style="color: var(--foreground);">
                                                                åˆ†æ®µå‡ºå ´æ¢ä»¶
                                                            </label>
                                                            <select
                                                                id="exitStagingMode"
                                                                class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-xs"
                                                                style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                            >
                                                                <option value="signal_repeat">ç­–ç•¥è¨Šè™Ÿå†è§¸ç™¼ï¼ˆæœ‰æ¢ä»¶è³£ï¼‰</option>
                                                                <option value="price_rally">åƒ¹æ ¼èµ°é«˜åˆ†æ‰¹å‡ºå ´ï¼ˆæ›´è²´è³£ï¼‰</option>
                                                            </select>
                                                            <p class="text-[11px] leading-snug" style="color: var(--muted-foreground);">
                                                                ã€Œåƒ¹æ ¼èµ°é«˜åˆ†æ‰¹å‡ºå ´ã€æœƒåœ¨é¦–æ¬¡è³£å‡ºå¾Œã€æ”¶ç›¤åƒ¹çªç ´å‰ä¸€æ®µçš„æˆäº¤åƒ¹æ™‚è‡ªå‹•å‡ºæ¸…ä¸‹ä¸€æ®µï¼›ã€Œç­–ç•¥è¨Šè™Ÿå†è§¸ç™¼ã€å‰‡éœ€ç­–ç•¥æ¢ä»¶æ¬¡æˆç«‹æ‰æœƒçºŒè³£ã€‚
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label for="stopLoss" class="tooltip block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">
                                                å›ºå®šåœæ (%)
                                                <span class="tooltiptext">è™§æé”æ­¤%å¼·åˆ¶å‡ºå ´(å¤šå–®åœæ/ç©ºå–®å›è£œ),å„ªå…ˆæ–¼ç­–ç•¥ä¿¡è™Ÿã€‚0=ä¸å•Ÿç”¨ã€‚</span>
                                            </label>
                                            <input type="number" id="stopLoss" value="0" min="0" max="100" step="0.5" class="w-full px-3 py-2 border border-border rounded-md shadow-sm text-sm focus:ring-accent focus:border-accent bg-input text-foreground" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);">
                                        </div>
                                        <div>
                                            <label for="takeProfit" class="tooltip block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">
                                                å›ºå®šåœåˆ© (%)
                                                <span class="tooltiptext">ç²åˆ©é”æ­¤%å¼·åˆ¶å‡ºå ´(å¤šå–®åœåˆ©/ç©ºå–®å›è£œ),å„ªå…ˆæ–¼ç­–ç•¥ä¿¡è™Ÿã€‚0=ä¸å•Ÿç”¨ã€‚</span>
                                            </label>
                                            <input type="number" id="takeProfit" value="0" min="0" max="1000" step="0.5" class="w-full px-3 py-2 border border-border rounded-md shadow-sm text-sm focus:ring-accent focus:border-accent bg-input text-foreground" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);">
                                        </div>
                                    </div>
                                </div>
                                <!-- Strategy Settings Card -->
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title flex items-center gap-2">
                                            <i data-lucide="target" class="lucide text-primary" style="color: var(--primary);"></i>
                                            ç­–ç•¥è¨­å®š
                                        </h3>
                                        <p class="card-description">è¨­å®šé€²å ´å’Œå‡ºå ´æ¢ä»¶</p>
                                    </div>
                                    <div class="card-content space-y-6">
                                        <div class="grid md:grid-cols-2 gap-6">
                                            <div>
                                                <label for="entryStrategy" class="block text-xs font-medium text-foreground mb-2" style="color: var(--foreground);">
                                                    <i data-lucide="arrow-up-circle" class="lucide-sm inline mr-1 text-green-600"></i>
                                                    åšå¤šé€²å ´ç­–ç•¥
                                                </label>
                                                <select
                                                    id="entryStrategy"
                                                    class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm"
                                                    style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                >
                                                    <option value="ma_cross">å‡ç·šé»ƒé‡‘äº¤å‰</option>
                                                    <option value="ma_above">åƒ¹æ ¼çªç ´å‡ç·š</option>
                                                    <option value="rsi_oversold">RSIè¶…è³£</option>
                                                    <option value="macd_cross">MACDé»ƒé‡‘äº¤å‰ (DIç‰ˆ)</option>
                                                    <option value="bollinger_breakout">å¸ƒæ—é€šé“çªç ´</option>
                                                    <option value="k_d_cross">KDé»ƒé‡‘äº¤å‰ (D&lt;X)</option>
                                                    <option value="volume_spike">æˆäº¤é‡æš´å¢</option>
                                                    <option value="price_breakout">åƒ¹æ ¼çªç ´å‰é«˜</option>
                                                    <option value="williams_oversold">å¨å»‰æŒ‡æ¨™è¶…è³£</option>
                                                    <option value="turtle_breakout">æµ·é¾œçªç ´ (åƒ…é€²å ´)</option>
                                                </select>
                                                <div id="entryParams" class="mt-4 space-y-3"></div>
                                            </div>

                                            <div class="space-y-3">
                                                <label for="exitStrategy" class="block text-xs font-medium text-foreground mb-2" style="color: var(--foreground);">
                                                    <i data-lucide="arrow-down-circle" class="lucide-sm inline mr-1 text-red-600"></i>
                                                    åšå¤šå‡ºå ´ç­–ç•¥
                                                </label>
                                                <select
                                                    id="exitStrategy"
                                                    class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm"
                                                    style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                >
                                                    <option value="ma_cross">å‡ç·šæ­»äº¡äº¤å‰</option>
                                                    <option value="ma_below">åƒ¹æ ¼è·Œç ´å‡ç·š</option>
                                                    <option value="rsi_overbought">RSIè¶…è²·</option>
                                                    <option value="macd_cross">MACDæ­»äº¡äº¤å‰ (DIç‰ˆ)</option>
                                                    <option value="bollinger_reversal">å¸ƒæ—é€šé“åè½‰</option>
                                                    <option value="k_d_cross">KDæ­»äº¡äº¤å‰ (D&gt;Y)</option>
                                                    <option value="volume_spike">æˆäº¤é‡æš´å¢</option>
                                                    <option value="price_breakdown">åƒ¹æ ¼è·Œç ´å‰ä½</option>
                                                    <option value="williams_overbought">å¨å»‰æŒ‡æ¨™è¶…è²·</option>
                                                    <option value="turtle_stop_loss">æµ·é¾œåœæ (Næ—¥ä½)</option>
                                                    <option value="trailing_stop">ç§»å‹•åœæ (%)</option>
                                                    <option value="fixed_stop_loss">(ç”±é¢¨éšªç®¡ç†æ§åˆ¶)</option>
                                                </select>
                                                <div id="exitParams" class="mt-4 space-y-3"></div>
                                            </div>
                                        </div>

                                        <!-- Short Selling Option -->
                                        <div class="border-t pt-4" style="border-color: var(--border);">
                                            <label class="flex items-center mb-4">
                                                <input type="checkbox" id="enableShortSelling" class="mr-2" />
                                                <span class="text-xs font-medium text-foreground" style="color: var(--foreground);">
                                                    <i data-lucide="trending-down" class="lucide-sm inline mr-1 text-red-600"></i>
                                                    å•Ÿç”¨åšç©ºäº¤æ˜“
                                                </span>
                                            </label>

                                            <div id="short-strategy-area" class="hidden space-y-4">
                                                <div class="grid md:grid-cols-2 gap-4">
                                                    <div>
                                                        <label for="shortEntryStrategy" class="block text-xs font-medium text-foreground mb-2" style="color: var(--foreground);">åšç©ºé€²å ´ç­–ç•¥</label>
                                                        <select
                                                            id="shortEntryStrategy"
                                                            class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm"
                                                            style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                        >
                                                            <option value="short_ma_cross">å‡ç·šæ­»äº¡äº¤å‰ (åšç©º)</option>
                                                            <option value="short_ma_below">åƒ¹æ ¼è·Œç ´å‡ç·š (åšç©º)</option>
                                                            <option value="short_rsi_overbought">RSIè¶…è²· (åšç©º)</option>
                                                            <option value="short_macd_cross">MACDæ­»äº¡äº¤å‰ (DIç‰ˆ) (åšç©º)</option>
                                                            <option value="short_bollinger_reversal">å¸ƒæ—é€šé“åè½‰ (åšç©º)</option>
                                                            <option value="short_k_d_cross">KDæ­»äº¡äº¤å‰ (D&gt;Y) (åšç©º)</option>
                                                            <option value="short_price_breakdown">åƒ¹æ ¼è·Œç ´å‰ä½ (åšç©º)</option>
                                                            <option value="short_williams_overbought">å¨å»‰æŒ‡æ¨™è¶…è²· (åšç©º)</option>
                                                            <option value="short_turtle_stop_loss">æµ·é¾œNæ—¥ä½ (åšç©º)</option>
                                                        </select>
                                                        <div id="shortEntryParams" class="mt-3 space-y-2"></div>
                                                    </div>

                                                    <div>
                                                        <label for="shortExitStrategy" class="block text-xs font-medium text-foreground mb-2" style="color: var(--foreground);">å›è£œå‡ºå ´ç­–ç•¥</label>
                                                        <select
                                                            id="shortExitStrategy"
                                                            class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm"
                                                            style="border-color: var(--border); background-color: var(--input); color: var(--foreground);"
                                                        >
                                                            <option value="cover_ma_cross">å‡ç·šé»ƒé‡‘äº¤å‰ (å›è£œ)</option>
                                                            <option value="cover_ma_above">åƒ¹æ ¼çªç ´å‡ç·š (å›è£œ)</option>
                                                            <option value="cover_rsi_oversold">RSIè¶…è³£ (å›è£œ)</option>
                                                            <option value="cover_macd_cross">MACDé»ƒé‡‘äº¤å‰ (DIç‰ˆ) (å›è£œ)</option>
                                                            <option value="cover_bollinger_breakout">å¸ƒæ—é€šé“çªç ´ (å›è£œ)</option>
                                                            <option value="cover_k_d_cross">KDé»ƒé‡‘äº¤å‰ (D&lt;X) (å›è£œ)</option>
                                                            <option value="cover_price_breakout">åƒ¹æ ¼çªç ´å‰é«˜ (å›è£œ)</option>
                                                            <option value="cover_williams_oversold">å¨å»‰æŒ‡æ¨™è¶…è³£ (å›è£œ)</option>
                                                            <option value="cover_turtle_breakout">æµ·é¾œNæ—¥é«˜ (å›è£œ)</option>
                                                            <option value="cover_trailing_stop">ç§»å‹•åœæ (%) (ç©ºå–®åœæ)</option>
                                                            <option value="cover_fixed_stop_loss">(ç”±é¢¨éšªç®¡ç†æ§åˆ¶)</option>
                                                        </select>
                                                        <div id="shortExitParams" class="mt-3 space-y-2"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Strategy Management -->
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title flex items-center gap-2">
                                        <i data-lucide="file-text" class="lucide text-accent" style="color: var(--accent);"></i>
                                        <span class="tooltip">
                                            ç­–ç•¥ç®¡ç†
                                            <span class="tooltiptext">å„²å­˜ã€è¼‰å…¥ã€åˆªé™¤æ‚¨çš„å›æ¸¬ç­–ç•¥è¨­å®š (åŒ…å«é¢¨éšªç®¡ç†)ã€‚æŒ‡æ¨™æœƒå„²å­˜æœ€å¾Œå›æ¸¬çµæœã€‚</span>
                                        </span>
                                    </h3>
                                </div>
                                <div class="card-content space-y-3">
                                    <div>
                                        <label for="loadStrategySelect" class="block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">å·²å„²å­˜ç­–ç•¥ (åç¨± | å¹´åŒ–% | å¤æ™®å€¼)</label>
                                        <select id="loadStrategySelect" class="w-full px-3 py-2 border border-border rounded-md shadow-sm text-sm focus:ring-accent focus:border-accent bg-input text-foreground" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);">
                                            <option value="">-- é¸æ“‡è¦è¼‰å…¥çš„ç­–ç•¥ --</option>
                                        </select>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <button id="saveStrategyBtn" class="px-3 py-2 bg-transparent text-primary hover:bg-accent border border-primary text-sm rounded-md transition duration-150 ease-in-out flex-grow sm:flex-grow-0" style="color: var(--primary); border-color: var(--primary);">
                                            <i data-lucide="save" class="lucide-sm mr-1"></i>å„²å­˜ç›®å‰
                                        </button>
                                        <button id="loadStrategyBtn" class="px-3 py-2 bg-transparent text-primary hover:bg-accent border border-primary text-sm rounded-md transition duration-150 ease-in-out flex-grow sm:flex-grow-0" style="color: var(--primary); border-color: var(--primary);">
                                            <i data-lucide="folder-open" class="lucide-sm mr-1"></i>è¼‰å…¥é¸å®š
                                        </button>
                                        <button id="deleteStrategyBtn" class="px-3 py-2 bg-transparent text-primary hover:bg-accent border border-primary text-sm rounded-md transition duration-150 ease-in-out flex-grow sm:flex-grow-0" style="color: var(--primary); border-color: var(--primary);">
                                            <i data-lucide="trash-2" class="lucide-sm mr-1"></i>åˆªé™¤é¸å®š
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Results -->
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title flex items-center gap-2">
                                        <i data-lucide="zap" class="lucide text-accent" style="color: var(--accent);"></i>
                                        å¿«é€Ÿçµæœ
                                    </h3>
                                </div>
                                <div class="card-content">
                                    <div
                                        id="result"
                                        class="text-sm text-muted min-h-[100px] flex items-center justify-center border-2 border-dashed rounded-lg p-4"
                                        style="color: var(--muted-foreground); border-color: var(--card);"
                                    >
                                        åŸ·è¡Œå›æ¸¬å¾Œå°‡é¡¯ç¤ºçµæœæ‘˜è¦
                                    </div>
                                </div>
                            </div>

                            <!-- Today Suggestion -->
                            <div class="card hidden" id="today-suggestion-area" aria-live="polite">
                                <div class="card-header pb-2">
                                    <h3 class="card-title flex items-center gap-2">
                                        <i data-lucide="lightbulb" class="lucide text-accent" style="color: var(--accent);"></i>
                                        ä»Šæ—¥å»ºè­°
                                    </h3>
                                </div>
                                <div class="card-content pt-0 space-y-4">
                                    <div id="today-suggestion-empty" class="today-suggestion-empty">
                                        åŸ·è¡Œå›æ¸¬å¾Œå°‡ä¾æœ€æ–°è³‡æ–™æ¨å°ä»Šæ—¥çš„æ“ä½œæŒ‡å¼•
                                    </div>
                                    <div id="today-suggestion-body" class="today-suggestion-body hidden">
                                        <div id="today-suggestion-banner" class="today-suggestion-highlight">
                                            <div class="today-suggestion-topline">
                                                <span id="today-suggestion-label" class="today-suggestion-chip">è¨ˆç®—ä¸­</span>
                                                <span id="today-suggestion-date" class="today-suggestion-date">â€”</span>
                                            </div>
                                            <div id="today-suggestion-message" class="today-suggestion-message">â€”</div>
                                        </div>
                                        <div id="today-suggestion-controls" class="today-suggestion-controls">
                                            <button
                                                id="today-suggestion-stats-toggle"
                                                type="button"
                                                class="today-suggestion-toggle"
                                                aria-expanded="false"
                                                aria-controls="today-suggestion-stats-wrapper"
                                            >
                                                <span class="toggle-indicator">ï¼‹</span>
                                                <span class="toggle-label">å±•é–‹éƒ¨ä½æ¦‚æ³</span>
                                            </button>
                                        </div>
                                        <div id="today-suggestion-stats-wrapper" class="today-suggestion-stats-wrapper hidden" aria-hidden="true">
                                            <dl class="today-suggestion-stats">
                                                <div class="today-suggestion-stat">
                                                    <dt class="today-suggestion-stat-label">å¤šå–®æ¦‚æ³</dt>
                                                    <dd id="today-suggestion-long" class="today-suggestion-stat-value">â€”</dd>
                                                </div>
                                                <div class="today-suggestion-stat">
                                                    <dt class="today-suggestion-stat-label">ç©ºå–®æ¦‚æ³</dt>
                                                    <dd id="today-suggestion-short" class="today-suggestion-stat-value">â€”</dd>
                                                </div>
                                                <div class="today-suggestion-stat">
                                                    <dt class="today-suggestion-stat-label">æ•´é«”éƒ¨ä½</dt>
                                                    <dd id="today-suggestion-position" class="today-suggestion-stat-value">â€”</dd>
                                                </div>
                                                <div class="today-suggestion-stat">
                                                    <dt class="today-suggestion-stat-label">è³‡ç”¢ä¼°å€¼</dt>
                                                    <dd id="today-suggestion-portfolio" class="today-suggestion-stat-value">â€”</dd>
                                                </div>
                                            </dl>
                                        </div>
                                        <div id="today-suggestion-notes-container" class="today-suggestion-notes hidden">
                                            <div class="today-suggestion-notes-title">å‚™è¨»</div>
                                            <ul id="today-suggestion-notes" class="today-suggestion-notes-list"></ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Loading/Progress -->
                            <div class="card hidden" id="loading">
                                <div class="card-header">
                                    <h3 class="card-title">åŸ·è¡Œä¸­...</h3>
                                </div>
                                <div class="card-content">
                                    <div class="space-y-3">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="loading-mascot-wrapper square w-14 h-14 overflow-hidden flex items-center justify-center"
                                                aria-hidden="true"
                                            >
                                                <div
                                                    id="loadingGif"
                                                    class="loading-mascot-canvas"
                                                    data-mascot-src="https://tenor.com/zh-TW/view/hachiware-gif-1718069610368761676"
                                                >
                                                    <img
                                                        class="loading-mascot-image"
                                                        src="https://tenor.com/zh-TW/view/hachiware-gif-1718069610368761676"
                                                        alt="LazyBacktest é€²åº¦å‰ç¥¥ç‰©å‹•ç•«"
                                                        decoding="async"
                                                        loading="eager"
                                                        referrerpolicy="no-referrer"
                                                        aria-hidden="true"
                                                    />
                                                </div>
                                            </div>
                                            <p
                                                id="loadingText"
                                                class="text-sm text-muted"
                                                style="color: var(--muted-foreground);"
                                            >
                                                æº–å‚™ä¸­...
                                            </p>
                                        </div>
                                        <div class="w-full bg-muted rounded-full h-2" style="background-color: var(--muted);">
                                            <div
                                                id="progressBar"
                                                class="bg-primary h-2 rounded-full transition-all duration-300"
                                                style="width: 0%; background-color: var(--primary);"
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="card shadow-lg border-2 border-primary/20" style="border-color: color-mix(in srgb, var(--primary) 20%, transparent);">
                                <div class="card-header">
                                    <h3 class="card-title flex items-center gap-2 text-primary" style="color: var(--primary);">
                                        <i data-lucide="play" class="lucide"></i>
                                        åŸ·è¡Œå›æ¸¬
                                    </h3>
                                </div>
                                <div class="card-content space-y-4">
                                    <button
                                        id="backtestBtn"
                                        class="w-full btn-primary text-lg py-6 rounded-lg font-semibold transition duration-150 ease-in-out flex items-center justify-center"
                                    >
                                        <i data-lucide="play" class="lucide mr-2"></i>
                                        é–‹å§‹å›æ¸¬
                                    </button>

                                    <div class="grid grid-cols-1 gap-2">
                                        <button id="resetBtn" class="btn-outline text-sm py-2 rounded-md font-medium transition duration-150 ease-in-out flex items-center justify-center">
                                            <i data-lucide="refresh-cw" class="lucide-sm mr-1"></i>
                                            é‡ç½®è¨­å®š
                                        </button>
                                        <button id="randomizeBtn" class="btn-outline text-sm py-2 rounded-md font-medium transition duration-150 ease-in-out flex items-center justify-center">
                                            <i data-lucide="shuffle" class="lucide-sm mr-1"></i>
                                            éš¨æ©Ÿåƒæ•¸
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Right Panel - Tabs Content -->
                        <div class="space-y-6 lg:overflow-y-auto lg:h-screen lg:pb-8 overflow-x-hidden right-panel" style="scrollbar-width: thin; scrollbar-color: var(--muted) var(--background);">
                            <!-- Tab Navigation -->
                            <div class="card sticky-header">
                                <div class="card-header pb-4">
                                    <div class="border-b border-border" style="border-color: var(--border);">
                                        <nav class="flex space-x-8 overflow-x-auto">
                                            <button
                                                class="tab py-4 px-1 border-b-2 border-primary text-primary font-medium text-xs whitespace-nowrap"
                                                style="color: var(--primary); border-color: var(--primary);"
                                                data-tab="summary"
                                                aria-current="page"
                                            >
                                                <i data-lucide="clipboard-list" class="lucide-sm inline mr-1"></i>æ‘˜è¦
                                            </button>
                                            <button
                                                class="tab py-4 px-1 border-b-2 border-transparent text-muted hover:text-foreground font-medium text-xs whitespace-nowrap"
                                                style="color: var(--muted-foreground);"
                                                data-tab="staging-optimizer"
                                            >
                                                <i data-lucide="wand-2" class="lucide-sm inline mr-1"></i>åˆ†æ®µå„ªåŒ–
                                            </button>
                                            <button
                                                class="tab py-4 px-1 border-b-2 border-transparent text-muted hover:text-foreground font-medium text-xs whitespace-nowrap"
                                                style="color: var(--muted-foreground);"
                                                data-tab="performance"
                                            >
                                                <i data-lucide="bar-chart-3" class="lucide-sm inline mr-1"></i>ç¸¾æ•ˆåˆ†æ
                                            </button>
                                            <button
                                                class="tab py-4 px-1 border-b-2 border-transparent text-muted hover:text-foreground font-medium text-xs whitespace-nowrap"
                                                style="color: var(--muted-foreground);"
                                                data-tab="trades"
                                            >
                                                <i data-lucide="receipt" class="lucide-sm inline mr-1"></i>äº¤æ˜“è¨˜éŒ„
                                            </button>
                                            <button
                                                class="tab py-4 px-1 border-b-2 border-transparent text-muted hover:text-foreground font-medium text-xs whitespace-nowrap"
                                                style="color: var(--muted-foreground);"
                                                data-tab="optimization"
                                            >
                                                <i data-lucide="sliders-horizontal" class="lucide-sm inline mr-1"></i>åƒæ•¸å„ªåŒ–
                                            </button>
                                            <button
                                                class="tab py-4 px-1 border-b-2 border-transparent text-muted hover:text-foreground font-medium text-xs whitespace-nowrap"
                                                style="color: var(--muted-foreground);"
                                                data-tab="batch-optimization"
                                            >
                                                <i data-lucide="users" class="lucide-sm inline mr-1"></i>æ‰¹é‡å„ªåŒ–
                                            </button>
                                            <button
                                                class="tab py-4 px-1 border-b-2 border-transparent text-muted hover:text-foreground font-medium text-xs whitespace-nowrap"
                                                style="color: var(--muted-foreground);"
                                                data-tab="rolling-test"
                                            >
                                                <i data-lucide="repeat" class="lucide-sm inline mr-1"></i>æ»¾å‹•æ¸¬è©¦
                                            </button>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Summary Tab -->
                            <div class="tab-content active space-y-6" id="summary-tab">
                                <!-- Strategy Status Card -->
                                <div class="card shadow-lg summary-card" id="strategy-status-card">
                                    <div class="card-header pb-4">
                                        <div class="space-y-2">
                                            <div class="flex items-center gap-2">
                                                <span id="strategy-status-badge" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-[10px] font-semibold tracking-wider uppercase" style="background-color: color-mix(in srgb, var(--muted) 28%, transparent); color: var(--muted-foreground);">ç­‰å¾…é–‹è³½</span>
                                                <span id="strategy-status-diff" class="text-xs font-semibold hidden" style="color: var(--muted-foreground);"></span>
                                            </div>
                                            <h3 id="strategy-status-title" class="text-lg font-semibold" style="color: var(--foreground);">ç­–ç•¥æˆ°æ³å°šæœªæ›´æ–°</h3>
                                            <p id="strategy-status-subtitle" class="text-xs leading-relaxed" style="color: var(--muted-foreground);">
                                                å®Œæˆå›æ¸¬å¾Œï¼Œé€™å¼µæˆ°å ±æœƒç¶œåˆç­–ç•¥èˆ‡è²·å…¥æŒæœ‰çš„å·®è·ã€æŒ‡æ¨™é«”æª¢èˆ‡å»ºè­°è¡Œå‹•ï¼Œè«‹å„ªå…ˆå›åˆ°æ­¤å¡ç‰‡æª¢è¦–çµæœã€‚
                                            </p>
                                        </div>
                                    </div>
                                    <div class="card-content space-y-3">
                                        <div id="strategy-status-detail" class="text-sm leading-relaxed space-y-2" style="color: var(--muted-foreground);">
                                            <p>â€¢ ç­‰å¾…æ‚¨å•Ÿå‹•å›æ¸¬ï¼Œæˆ‘å€‘æœƒè¿½è¹¤ç­–ç•¥èˆ‡è²·å…¥æŒæœ‰çš„å·®è·ä¸¦æå‡ºæŒ‡æ¨™é«”æª¢ã€‚</p>
                                            <p>â€¢ å›æ¸¬å®Œæˆå¾Œï¼Œé€™è£¡æœƒç”¨æ¢åˆ—å¼å¯«çµ¦æ•£æˆ¶çœ‹çš„æˆ°æ³æ‡¶äººåŒ…ã€‚</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Chart Area -->
                                <div class="card shadow-lg summary-card">
                                    <div class="card-header">
                                        <h3 class="card-title">æ·¨å€¼æ›²ç·šåœ–</h3>
                                    </div>
                                    <div class="card-content">
                                        <div id="chart-container" class="h-96 bg-muted/20 rounded-lg flex items-center justify-center border-2 border-dashed relative" style="background-color: color-mix(in srgb, var(--muted) 20%, transparent); border-color: var(--card);">
                                            <canvas id="chart" class="w-full h-full absolute inset-0"></canvas>
                                            <div class="text-muted text-center" style="color: var(--muted-foreground);">
                                                <i data-lucide="bar-chart-3" class="lucide w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                                <p>åŸ·è¡Œå›æ¸¬å¾Œå°‡é¡¯ç¤ºæ·¨å€¼æ›²ç·š</p>
                                            </div>
                                        </div>
                                        <div id="priceInspectorControls" class="mt-4 hidden flex flex-wrap items-center gap-2 justify-between sm:justify-start">
                                            <button
                                                type="button"
                                                id="openPriceInspector"
                                                class="px-3 py-1.5 text-[11px] font-medium rounded-md border transition-colors"
                                                style="border-color: var(--border); color: var(--foreground); background-color: var(--background);"
                                            >
                                                æŸ¥çœ‹å€é–“åƒ¹æ ¼
                                            </button>
                                            <span
                                                id="priceInspectorSummary"
                                                class="text-[11px] text-muted-foreground"
                                                style="color: var(--muted-foreground);"
                                            ></span>
                                        </div>
                                        <div id="trend-legend" class="mt-3 hidden flex items-center gap-3 text-xs text-muted-foreground overflow-x-auto whitespace-nowrap" aria-hidden="true">
                                            <div class="flex items-center gap-2 shrink-0">
                                                <span class="w-3 h-3 rounded-sm border" style="background-color: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.38);"></span>
                                                <span>ç‰›å¸‚ãƒ»é«˜æ³¢å‹•</span>
                                            </div>
                                            <div class="flex items-center gap-2 shrink-0">
                                                <span class="w-3 h-3 rounded-sm border" style="background-color: rgba(148, 163, 184, 0.18); border-color: rgba(148, 163, 184, 0.38);"></span>
                                                <span>ç›¤æ•´å€åŸŸ</span>
                                            </div>
                                            <div class="flex items-center gap-2 shrink-0">
                                                <span class="w-3 h-3 rounded-sm border" style="background-color: rgba(34, 197, 94, 0.2); border-color: rgba(34, 197, 94, 0.35);"></span>
                                                <span>ç†Šå¸‚ãƒ»é«˜æ³¢å‹•</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card shadow-lg summary-card" id="trend-analysis-card" data-collapsed="true">
                                    <div class="card-header">
                                        <button
                                            id="trendAnalysisToggle"
                                            type="button"
                                            class="w-full flex items-center justify-between gap-3 text-left"
                                            aria-expanded="false"
                                            aria-controls="trend-analysis-content"
                                        >
                                            <span class="card-title flex items-center gap-3">
                                                <span class="trend-toggle-indicator" aria-hidden="true">ï¼‹</span>
                                                <i data-lucide="line-chart" class="lucide-sm" aria-hidden="true"></i>
                                                <span>è¶¨å‹¢å€é–“è©•ä¼°</span>
                                            </span>
                                            <span class="text-xs text-muted-foreground" data-trend-toggle-label>å±•é–‹åˆ†æ</span>
                                        </button>
                                    </div>
                                    <div id="trend-analysis-content" class="card-content space-y-4 hidden" aria-hidden="true">
                                        <p class="text-xs leading-relaxed" style="color: var(--muted-foreground);">
                                            å°‡åƒ¹æ ¼åºåˆ—æ‹†æˆç‰›å¸‚ãƒ»é«˜æ³¢å‹•ã€ç†Šå¸‚ãƒ»é«˜æ³¢å‹•èˆ‡ç›¤æ•´ä¸‰æ…‹ï¼Œçµåˆ ADXã€å¸ƒæ—å¸¶å¯¬èˆ‡ ATR æ¯”ç‡ä½œç‚ºè¶¨å‹¢ï¼ç›¤æ•´é–€æª»ï¼Œä¸¦ä»¥äºŒç¶­ HMM è¨“ç·´è¶¨å‹¢ç‹€æ…‹ï¼›æ»‘æ¡¿ 0â†’10 ç¶“ 1000 çµ„è¦†è“‹ç‡æ¸¬è©¦æ ¡æº–ï¼Œå¯å¿«é€Ÿåˆ‡æ›é è¨­æœ€ä½³å€¼ 5 é™„è¿‘çš„ä¿¡å¿ƒé–€æª»ï¼Œæ•¸å€¼è¶Šé«˜é–€æª»è¶Šå¯¬é¬†ã€è¶¨å‹¢è¦†è“‹è¶Šæ¥è¿‘ 80% ä»¥ä¸Šã€‚
                                        </p>
                                        <div id="trend-card-legend" class="flex items-center gap-3 text-xs text-muted-foreground overflow-x-auto whitespace-nowrap">
                                            <div class="flex items-center gap-2 shrink-0">
                                                <span class="w-3 h-3 rounded-sm border" style="background-color: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.38);"></span>
                                                <span>ç‰›å¸‚ãƒ»é«˜æ³¢å‹•</span>
                                            </div>
                                            <div class="flex items-center gap-2 shrink-0">
                                                <span class="w-3 h-3 rounded-sm border" style="background-color: rgba(148, 163, 184, 0.18); border-color: rgba(148, 163, 184, 0.38);"></span>
                                                <span>ç›¤æ•´å€åŸŸ</span>
                                            </div>
                                            <div class="flex items-center gap-2 shrink-0">
                                                <span class="w-3 h-3 rounded-sm border" style="background-color: rgba(34, 197, 94, 0.2); border-color: rgba(34, 197, 94, 0.35);"></span>
                                                <span>ç†Šå¸‚ãƒ»é«˜æ³¢å‹•</span>
                                            </div>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex items-center justify-between">
                                                <label for="trendSensitivitySlider" class="text-xs font-medium" style="color: var(--foreground);">ç‹€æ…‹ç²¾ç´°åº¦</label>
                                                <span id="trendSensitivityValue" class="text-xs font-semibold" style="color: var(--primary);">å¹³å‡ç‹€æ…‹ä¿¡å¿ƒï¼šâ€”</span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <span class="text-[11px]" style="color: var(--muted-foreground);">0 ç²¾ç´°</span>
                                                <input type="range" id="trendSensitivitySlider" min="0" max="10" step="0.1" value="5" class="flex-1 trend-slider">
                                                <span class="text-[11px]" style="color: var(--muted-foreground);">10 å¯¬é¬†</span>
                                            </div>
                                            <p id="trend-threshold-text" class="text-[11px] leading-relaxed hidden" style="color: var(--muted-foreground);"></p>
                                        </div>
                                        <div id="trend-summary-placeholder" class="rounded-lg border border-dashed p-4 text-xs" style="border-color: color-mix(in srgb, var(--border) 80%, transparent); color: var(--muted-foreground);">
                                            åŸ·è¡Œå›æ¸¬å¾Œæœƒé¡¯ç¤ºç‰›å¸‚ãƒ»é«˜æ³¢å‹•ï¼ç›¤æ•´ï¼ç†Šå¸‚ãƒ»é«˜æ³¢å‹•ä¸‰æ…‹çš„è¦†è“‹ç‡ã€è¤‡åˆ©å ±é…¬èˆ‡ Sigmoid è£œå„Ÿçµ±è¨ˆã€‚
                                        </div>
                                        <div id="trend-summary-meta" class="hidden text-[11px]" style="color: var(--muted-foreground);"></div>
                                        <div id="trend-summary-container" class="trend-summary-grid"></div>
                                    </div>
                                </div>

                                <div class="card shadow-lg summary-card">
                                    <div class="card-header">
                                        <h3 class="card-title">å›æ¸¬æ‘˜è¦</h3>
                                    </div>
                                    <div class="card-content">
                                        <div id="backtest-result" class="summary-result-container">
                                            <div id="backtest-result-placeholder" class="backtest-result-placeholder">
                                                åŸ·è¡Œå›æ¸¬å¾Œå°‡é¡¯ç¤ºè©³ç´°çµæœ
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Summary Results -->
                            </div>

                            <!-- Staging Optimizer Tab -->
                            <div class="tab-content hidden" id="staging-optimizer-tab">
                                <div class="card shadow-lg mb-6">
                                    <div class="card-header">
                                        <h3 class="card-title flex items-center gap-2">
                                            <i data-lucide="sparkles" class="lucide text-accent" style="color: var(--accent);"></i>
                                            åˆ†æ®µå„ªåŒ–åŠ©æ‰‹
                                        </h3>
                                        <p class="card-description">è‡ªå‹•è©•ä¼°å¤šçµ„é€²å ´èˆ‡å‡ºå ´åˆ†æ®µï¼Œå°‹æ‰¾è¼ƒä½³çš„è³‡é‡‘é…ç½®æ–¹å¼</p>
                                    </div>
                                    <div class="card-content space-y-5">
                                        <p class="text-sm leading-relaxed" style="color: var(--muted-foreground);">
                                            ç³»çµ±æœƒé‡å°ç›®å‰ç­–ç•¥åƒæ•¸ä¾åºæ¸¬è©¦ä¸åŒçš„é€²å‡ºå ´åˆ†æ®µçµ„åˆï¼Œä½¿ç”¨å¹´åŒ–å ±é…¬ã€å¤æ™®æ¯”ç‡èˆ‡æœ€å¤§å›æ’¤åšç‚ºè©•ä¼°ä¾æ“šï¼Œå”åŠ©æ‚¨å¿«é€Ÿæ‰¾å‡ºè¼ƒç©©å¥çš„è³‡é‡‘èª¿åº¦ç¯€å¥ã€‚
                                        </p>
                                        <div class="flex flex-wrap items-center gap-3">
                                            <button
                                                id="stagingOptimizationBtn"
                                                class="btn-primary flex items-center gap-2 text-sm px-4 py-2 rounded-md font-semibold"
                                            >
                                                <i data-lucide="play-circle" class="lucide-sm"></i>
                                                ä¸€éµå„ªåŒ–åˆ†æ®µç­–ç•¥
                                            </button>
                                            <button
                                                id="applyStagingOptimizationBtn"
                                                class="btn-outline flex items-center gap-2 text-sm px-4 py-2 rounded-md font-medium"
                                                disabled
                                            >
                                                <i data-lucide="check" class="lucide-sm"></i>
                                                å¥—ç”¨æ¨è–¦åˆ†æ®µ
                                            </button>
                                            <span class="text-[11px]" style="color: var(--muted-foreground);">
                                                å»ºè­°å…ˆåŸ·è¡Œä¸€æ¬¡å›æ¸¬æˆ–ç¢ºèªåƒæ•¸ç„¡èª¤ï¼Œå†å•Ÿå‹•è‡ªå‹•å„ªåŒ–ã€‚
                                            </span>
                                        </div>
                                        <div id="staging-optimization-status" class="text-sm" style="color: var(--muted-foreground);">
                                            å°šæœªåŸ·è¡Œåˆ†æ®µå„ªåŒ–ã€‚
                                        </div>
                                        <div id="staging-optimization-progress" class="hidden space-y-2">
                                            <div class="w-full bg-muted rounded-full h-2" style="background-color: var(--muted);">
                                                <div id="staging-optimization-progress-bar" class="bg-accent h-2 rounded-full transition-all duration-300" style="width: 0%; background-color: var(--accent);"></div>
                                            </div>
                                        </div>
                                        <div id="staging-optimization-results" class="hidden space-y-4">
                                            <div id="staging-optimization-summary" class="text-sm" style="color: var(--foreground);"></div>
                                            <div class="overflow-x-auto">
                                                <table class="min-w-full divide-y divide-border text-sm" style="border-color: var(--border);">
                                                    <thead class="bg-muted" style="background-color: var(--muted);">
                                                        <tr>
                                                            <th class="px-3 py-2 text-left font-medium uppercase tracking-wider" style="color: var(--muted-foreground);">æ’å</th>
                                                            <th class="px-3 py-2 text-left font-medium uppercase tracking-wider" style="color: var(--muted-foreground);">é€²å ´åˆ†æ®µ (%)</th>
                                                            <th class="px-3 py-2 text-left font-medium uppercase tracking-wider" style="color: var(--muted-foreground);">é€²å ´æ¢ä»¶</th>
                                                            <th class="px-3 py-2 text-left font-medium uppercase tracking-wider" style="color: var(--muted-foreground);">å‡ºå ´åˆ†æ®µ (%)</th>
                                                            <th class="px-3 py-2 text-left font-medium uppercase tracking-wider" style="color: var(--muted-foreground);">å‡ºå ´æ¢ä»¶</th>
                                                            <th class="px-3 py-2 text-left font-medium uppercase tracking-wider" style="color: var(--muted-foreground);">å¹´åŒ–å ±é…¬</th>
                                                            <th class="px-3 py-2 text-left font-medium uppercase tracking-wider" style="color: var(--muted-foreground);">å¤æ™®æ¯”ç‡</th>
                                                            <th class="px-3 py-2 text-left font-medium uppercase tracking-wider" style="color: var(--muted-foreground);">æœ€å¤§å›æ’¤</th>
                                                            <th class="px-3 py-2 text-left font-medium uppercase tracking-wider" style="color: var(--muted-foreground);">äº¤æ˜“æ¬¡æ•¸</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="staging-optimization-table-body" class="bg-background divide-y divide-border" style="background-color: var(--background); border-color: var(--border);"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card border border-dashed" style="border-color: color-mix(in srgb, var(--border) 65%, transparent);">
                                    <div class="card-header pb-3">
                                        <h4 class="card-title text-sm font-semibold">è©•ä¼°é‚è¼¯èˆ‡å»ºè­°</h4>
                                    </div>
                                    <div class="card-content space-y-3 text-sm" style="color: var(--muted-foreground);">
                                        <p>â€¢ é€²å ´æ¸¬è©¦è¦†è“‹å–®æ®µæ»¿å€‰ã€å…©æ®µæ‹‰å›åŠ ç¢¼ã€ä¸‰æ®µé‡‘å­—å¡”èˆ‡å€’é‡‘å­—å¡”ç­‰å¸¸è¦‹é…ç½®ï¼Œå‡ºå ´å‰‡è©•ä¼°ç­‰åˆ†åˆ†æ‰¹ã€å‰é‡å¾Œè¼•èˆ‡æ¢¯å½¢ç²åˆ©æ–¹å¼ï¼›æ¯ä¸€çµ„é…ç½®éƒ½æœƒå†å¥—ç”¨ã€Œåƒ¹æ ¼å›è½åŠ ç¢¼ / ç­–ç•¥è¨Šè™Ÿå†è§¸ç™¼ã€èˆ‡ã€Œåƒ¹æ ¼èµ°é«˜åˆ†æ‰¹å‡ºå ´ / ç­–ç•¥è¨Šè™Ÿå†è§¸ç™¼ã€æ¢ä»¶ï¼Œç¸½è¨ˆæœ€å¤š 4 Ã— 42 çµ„æ¸¬è©¦ã€‚è‹¥é€²å ´æˆ–å‡ºå ´åƒ…æœ‰å–®æ®µ 100% é…ç½®ï¼Œç³»çµ±æœƒè‡ªå‹•ç•¥éæ¢ä»¶æ’åˆ—åƒ…åŸ·è¡Œä¸€æ¬¡åŸºæº–æ¸¬è©¦ï¼ŒåŠ å¿«è©•ä¼°é€Ÿåº¦ã€‚</p>
                                        <p>â€¢ æ’åºä»¥å¹´åŒ–å ±é…¬ç‚ºä¸»ã€å¤æ™®æ¯”ç‡ç‚ºæ¬¡ã€æœ€å¤§å›æ’¤ç‚ºè¼”ï¼Œè‹¥å ±é…¬ç›¸è¿‘æœƒå„ªå…ˆæ¨è–¦å›æ’¤è¼ƒå°ä¸”é¢¨éšªèª¿æ•´å¾Œå ±é…¬è¼ƒä½³çš„çµ„åˆã€‚</p>
                                        <p>â€¢ çµæœè¡¨æ–°å¢ã€Œé€²å ´æ¢ä»¶ã€ã€Œå‡ºå ´æ¢ä»¶ã€æ¬„ä½ï¼Œå”åŠ©è¾¨è­˜ä½¿ç”¨åƒ¹æ ¼æˆ–è¨Šè™Ÿè§¸ç™¼ï¼›å¥—ç”¨æ¨è–¦åˆ†æ®µæ™‚æœƒåŒæ­¥æ›´æ–°å°æ‡‰æ¢ä»¶ï¼Œä»å¯å†å¾®èª¿ç™¾åˆ†æ¯”æˆ–æ¨¡å¼ï¼Œå»ºè­°é‡æ–°å›æ¸¬ç¢ºèªèˆ‡å€‹äººé¢¨éšªæ‰¿å—åº¦æ˜¯å¦ä¸€è‡´ã€‚</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Performance Tab -->
                            <div class="tab-content hidden" id="performance-tab">
                                <div class="card shadow-lg">
                                    <div class="card-header">
                                        <h3 class="card-title">æœŸé–“ç¸¾æ•ˆåˆ†æ</h3>
                                    </div>
                                    <div class="card-content">
                                        <div
                                            id="performance-table-container"
                                            class="overflow-x-auto min-h-[200px] flex items-center justify-center border-2 border-dashed rounded-lg"
                                            style="border-color: var(--card);"
                                        >
                                            <p class="text-muted" style="color: var(--muted-foreground);">è«‹å…ˆåŸ·è¡Œå›æ¸¬ä»¥ç”ŸæˆæœŸé–“ç¸¾æ•ˆæ•¸æ“šã€‚</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Trades Tab -->
                            <div class="tab-content hidden" id="trades-tab">
                                <div class="card shadow-lg">
                                    <div class="card-header">
                                        <h3 class="card-title">äº¤æ˜“è¨˜éŒ„</h3>
                                    </div>
                                    <div class="card-content">
                                        <div
                                            id="trade-results"
                                            class="min-h-[900px] w-full border-2 border-dashed rounded-lg p-6 overflow-y-auto"
                                            style="border-color: var(--card);"
                                        >
                                            <div class="w-full h-full flex items-center justify-center">
                                                <p class="text-xs text-muted-foreground" style="color: var(--muted-foreground);">åŸ·è¡Œå›æ¸¬å¾Œå°‡é¡¯ç¤ºäº¤æ˜“æ˜ç´°</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Optimization Tab -->
                            <div class="tab-content hidden" id="optimization-tab">
                                <div class="card shadow-lg">
                                    <div class="card-header">
                                        <h3 class="card-title flex items-center gap-2">
                                            <i data-lucide="zap" class="lucide text-accent" style="color: var(--accent);"></i>
                                            åƒæ•¸å„ªåŒ–
                                        </h3>
                                        <p class="card-description">è‡ªå‹•å°‹æ‰¾æœ€ä½³åƒæ•¸çµ„åˆ</p>
                                    </div>
                                    <div class="card-content space-y-6">
                                        <!-- å„ªåŒ–æ§åˆ¶å€åŸŸ -->
                                        <div class="card bg-background border border-border" style="background-color: var(--background); border-color: var(--border);">
                                            <div class="card-header">
                                                <h4 class="card-title flex items-center gap-2">
                                                    <i data-lucide="sliders-horizontal" class="lucide text-primary" style="color: var(--primary);"></i>
                                                    å„ªåŒ–æ§åˆ¶
                                                </h4>
                                            </div>
                                            <div class="card-content">
                                                <!-- åšå¤šç­–ç•¥å„ªåŒ– -->
                                                <div class="mb-6">
                                                    <h5 class="text-md font-semibold text-foreground mb-3" style="color: var(--foreground);">åšå¤šç­–ç•¥å„ªåŒ–</h5>
                                                    <div class="grid md:grid-cols-3 gap-4">
                                                        <div class="flex items-center border border-border rounded-md" style="border-color: var(--border);">
                                                            <button id="optimizeEntryBtn" class="btn-primary text-sm font-medium rounded-l-md px-4 py-2 flex items-center whitespace-nowrap border-r border-border" style="border-color: var(--border);">
                                                                <i data-lucide="settings" class="lucide-sm mr-1"></i>
                                                                å„ªåŒ–é€²å ´
                                                            </button>
                                                            <select
                                                                id="optimizeEntryParamSelect"
                                                                class="flex-grow px-2 py-2 bg-input text-foreground text-sm rounded-r-md focus:outline-none"
                                                                style="background-color: var(--input); color: var(--foreground);"
                                                            ></select>
                                                        </div>

                                                        <div class="flex items-center border border-border rounded-md" style="border-color: var(--border);">
                                                            <button id="optimizeExitBtn" class="btn-secondary text-sm font-medium rounded-l-md px-4 py-2 flex items-center whitespace-nowrap border-r border-border" style="border-color: var(--border);">
                                                                <i data-lucide="wrench" class="lucide-sm mr-1"></i>
                                                                å„ªåŒ–å‡ºå ´
                                                            </button>
                                                            <select
                                                                id="optimizeExitParamSelect"
                                                                class="flex-grow px-2 py-2 bg-input text-foreground text-sm rounded-r-md focus:outline-none"
                                                                style="background-color: var(--input); color: var(--foreground);"
                                                            ></select>
                                                        </div>

                                                        <div class="flex items-center border border-border rounded-md" style="border-color: var(--border);">
                                                            <button id="optimizeRiskBtn" class="btn-outline text-sm font-medium rounded-l-md px-4 py-2 flex items-center whitespace-nowrap border-r border-border" style="border-color: var(--border);">
                                                                <i data-lucide="sliders-horizontal" class="lucide-sm mr-1"></i>
                                                                å„ªåŒ–é¢¨æ§
                                                            </button>
                                                            <select
                                                                id="optimizeRiskParamSelect"
                                                                class="flex-grow px-2 py-2 bg-input text-foreground text-sm rounded-r-md focus:outline-none"
                                                                style="background-color: var(--input); color: var(--foreground);"
                                                            >
                                                                <option value="stopLoss">åœæ (%)</option>
                                                                <option value="takeProfit">åœåˆ© (%)</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- åšç©ºç­–ç•¥å„ªåŒ– -->
                                                <div>
                                                    <h5 class="text-md font-semibold text-foreground mb-3" style="color: var(--foreground);">åšç©ºç­–ç•¥å„ªåŒ–</h5>
                                                    <div class="grid md:grid-cols-2 gap-4">
                                                        <div class="flex items-center border border-border rounded-md" style="border-color: var(--border);">
                                                            <button id="optimizeShortEntryBtn" class="btn-outline text-sm font-medium rounded-l-md px-4 py-2 flex items-center whitespace-nowrap border-r border-border" style="border-color: var(--border);">
                                                                <i data-lucide="trending-down" class="lucide-sm mr-1"></i>
                                                                å„ªåŒ–åšç©ºé€²å ´
                                                            </button>
                                                            <select
                                                                id="optimizeShortEntryParamSelect"
                                                                class="flex-grow px-2 py-2 bg-input text-foreground text-sm rounded-r-md focus:outline-none"
                                                                style="background-color: var(--input); color: var(--foreground);"
                                                            ></select>
                                                        </div>
                                                        <div class="flex items-center border border-border rounded-md" style="border-color: var(--border);">
                                                            <button id="optimizeShortExitBtn" class="btn-outline text-sm font-medium rounded-l-md px-4 py-2 flex items-center whitespace-nowrap border-r border-border" style="border-color: var(--border);">
                                                                <i data-lucide="trending-up" class="lucide-sm mr-1"></i>
                                                                å„ªåŒ–å›è£œå‡ºå ´
                                                            </button>
                                                            <select
                                                                id="optimizeShortExitParamSelect"
                                                                class="flex-grow px-2 py-2 bg-input text-foreground text-sm rounded-r-md focus:outline-none"
                                                                style="background-color: var(--input); color: var(--foreground);"
                                                            ></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- å„ªåŒ–é€²åº¦å€åŸŸ -->
                                        <div id="optimization-progress-section" class="card bg-primary/5 border-2 border-primary/20 hidden" style="background-color: color-mix(in srgb, var(--primary) 5%, transparent); border-color: color-mix(in srgb, var(--primary) 20%, transparent);">
                                            <div class="card-header">
                                                <h4 class="card-title flex items-center gap-2">
                                                    <i data-lucide="loader" class="lucide text-primary animate-spin" style="color: var(--primary);"></i>
                                                    å„ªåŒ–é€²è¡Œä¸­
                                                </h4>
                                            </div>
                                            <div class="card-content">
                                                <div class="mb-3">
                                                    <span id="optimization-status-text" class="text-foreground font-medium" style="color: var(--foreground);">âŒ› æº–å‚™å„ªåŒ–...</span>
                                                </div>
                                                <div class="w-full bg-muted rounded-full h-3 shadow-inner" style="background-color: var(--muted);">
                                                    <div 
                                                        id="optimization-progress-bar" 
                                                        class="bg-primary h-3 rounded-full transition-all duration-500 ease-out"
                                                        style="width: 0%; background-color: var(--primary);"
                                                    ></div>
                                                </div>
                                                <div class="mt-2 text-sm text-muted font-medium" style="color: var(--muted-foreground);">
                                                    é€²åº¦: <span id="optimization-progress-text" class="text-primary" style="color: var(--primary);">0%</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- å„ªåŒ–çµæœå€åŸŸ -->
                                        <div class="card bg-background border border-border" style="background-color: var(--background); border-color: var(--border);">
                                            <div class="card-header">
                                                <h4 id="optimization-title" class="card-title flex items-center gap-2">
                                                    <i data-lucide="trending-up" class="lucide text-primary" style="color: var(--primary);"></i>
                                                    å„ªåŒ–çµæœ
                                                </h4>
                                            </div>
                                            <div class="card-content">
                                                <div id="optimization-results" class="optimization-results">
                                                    <p class="text-muted" style="color: var(--muted-foreground);">è«‹é¸æ“‡è¦å„ªåŒ–çš„ç­–ç•¥åƒæ•¸ï¼Œç„¶å¾Œé»é¸å„ªåŒ–æŒ‰éˆ•é–‹å§‹å„ªåŒ–ã€‚</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Batch Optimization Tab -->
                            <div class="tab-content hidden" id="batch-optimization-tab">
                                <div class="card shadow-lg">
                                    <div class="card-header">
                                        <h3 class="card-title flex items-center gap-2">
                                            <i data-lucide="users" class="lucide text-primary" style="color: var(--primary);"></i>
                                            æ‰¹é‡ç­–ç•¥å„ªåŒ–
                                        </h3>
                                        <p class="card-description">åŒæ™‚æ¸¬è©¦å¤šç¨®ç­–ç•¥çµ„åˆ</p>
                                    </div>
                                    <div class="card-content space-y-6">
                                        <div id="batch-optimization-content">
                                            <div class="space-y-6">
                                                <!-- ç­–ç•¥é¸æ“‡å€åŸŸ -->
                                                <div class="card bg-background border border-border" style="background-color: var(--background); border-color: var(--border);">
                                                    <div class="card-header">
                                                        <h4 class="card-title flex items-center gap-2">
                                                            <i data-lucide="settings" class="lucide text-primary" style="color: var(--primary);"></i>
                                                            ç­–ç•¥çµ„åˆé¸æ“‡
                                                        </h4>
                                                    </div>
                                                    <div class="card-content">
                                                        <div class="grid md:grid-cols-2 gap-4">
                                                            <div>
                                                                <label class="block text-xs font-medium text-foreground mb-2" style="color: var(--foreground);">è²·å…¥ç­–ç•¥ (å¯å¤šé¸)</label>
                                                                <div id="buy-strategies-list" class="space-y-2 max-h-48 overflow-y-auto border border-border rounded-md p-3" style="border-color: var(--border);">
                                                                    <!-- å‹•æ…‹ç”Ÿæˆè²·å…¥ç­–ç•¥é¸é … -->
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <label class="block text-xs font-medium text-foreground mb-2" style="color: var(--foreground);">è³£å‡ºç­–ç•¥ (å¯å¤šé¸)</label>
                                                                <div id="sell-strategies-list" class="space-y-2 max-h-48 overflow-y-auto border border-border rounded-md p-3" style="border-color: var(--border);">
                                                                    <!-- å‹•æ…‹ç”Ÿæˆè³£å‡ºç­–ç•¥é¸é … -->
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="flex items-center gap-2 mt-4">
                                                            <button id="select-all-buy" class="btn-outline text-sm py-2 px-3 rounded">å…¨é¸è²·å…¥</button>
                                                            <button id="select-all-sell" class="btn-outline text-sm py-2 px-3 rounded">å…¨é¸è³£å‡º</button>
                                                            <button id="clear-all" class="btn-outline text-sm py-2 px-3 rounded">æ¸…é™¤å…¨éƒ¨</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- å„ªåŒ–è¨­å®šå€åŸŸ -->
                                                <div class="card bg-background border border-border" style="background-color: var(--background); border-color: var(--border);">
                                                    <div class="card-header">
                                                        <h4 class="card-title flex items-center gap-2">
                                                            <i data-lucide="sliders-horizontal" class="lucide text-accent" style="color: var(--accent);"></i>
                                                            å„ªåŒ–è¨­å®š
                                                        </h4>
                                                    </div>
                                                    <div class="card-content space-y-4">
                                                        <div>
                                                            <h4 class="font-medium text-foreground mb-3" style="color: var(--foreground);">å„ªåŒ–ç›®æ¨™æŒ‡æ¨™</h4>
                                                            <div class="flex flex-wrap gap-4">
                                                                <label class="flex items-center">
                                                                    <input type="radio" name="batch-target-metric" value="annualizedReturn" checked class="mr-2" />
                                                                    <span class="text-sm" style="color: var(--foreground);">å¹´åŒ–å ±é…¬ç‡</span>
                                                                </label>
                                                                <label class="flex items-center">
                                                                    <input type="radio" name="batch-target-metric" value="sharpeRatio" class="mr-2" />
                                                                    <span class="text-sm" style="color: var(--foreground);">å¤æ™®æ¯”ç‡</span>
                                                                </label>
                                                                <label class="flex items-center">
                                                                    <input type="radio" name="batch-target-metric" value="sortinoRatio" class="mr-2" />
                                                                    <span class="text-sm" style="color: var(--foreground);">ç´¢æè«¾æ¯”ç‡</span>
                                                                </label>
                                                                <label class="flex items-center">
                                                                    <input type="radio" name="batch-target-metric" value="maxDrawdown" class="mr-2" />
                                                                    <span class="text-sm" style="color: var(--foreground);">æœ€å¤§å›æ’¤</span>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="grid md:grid-cols-3 gap-4">
                                                            <div>
                                                                <label for="batch-optimize-parameter-trials" class="block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">åƒæ•¸å„ªåŒ–æ¬¡æ•¸</label>
                                                                <input type="number" id="batch-optimize-parameter-trials" value="100" min="10" max="1000" step="10" class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);" />
                                                                <p class="text-xs text-muted-foreground mt-1" style="color: var(--muted-foreground);">å°æ¯å€‹ç­–ç•¥é€²è¡Œåƒæ•¸å„ªåŒ–çš„æ¸¬è©¦æ¬¡æ•¸</p>
                                                            </div>
                                                            <div>
                                                                <label for="batch-optimize-concurrency" class="block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">å„ªåŒ–ä½µç™¼æ•¸</label>
                                                                <input type="number" id="batch-optimize-concurrency" value="4" min="1" max="32" step="1" title="å»ºè­°è¨­å®šç‚º CPU å¯¦é«”/é‚è¼¯æ ¸å¿ƒæ•¸ï¼ˆnavigator.hardwareConcurrencyï¼‰ï¼Œè¼ƒé«˜ä½µç™¼æœƒå¢åŠ  CPU èˆ‡è¨˜æ†¶é«”è² è¼‰" class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);" />
                                                                <p class="text-xs text-muted-foreground mt-1" style="color: var(--muted-foreground);">å»ºè­°å€¼ï¼šâ‰¤ CPU æ ¸å¿ƒæ•¸ï¼ˆè‹¥ç€è¦½å™¨æ”¯æ´ï¼‰ã€‚é è¨­ 4ã€‚</p>
                                                            </div>
                                                            <div>
                                                                <label for="batch-optimize-iteration-limit" class="block text-xs font-medium text-foreground mb-1" style="color: var(--foreground);">è¿­ä»£ä¸Šé™ (è¿­ä»£æ¬¡æ•¸ä¸Šé™)</label>
                                                                <input type="number" id="batch-optimize-iteration-limit" value="6" min="1" max="100" step="1" class="w-full px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);" />
                                                                <p class="text-xs text-muted-foreground mt-1" style="color: var(--muted-foreground);">æ§åˆ¶æ¯å€‹çµ„åˆåœ¨ "äº¤æ›¿å„ªåŒ–" æµç¨‹ä¸­çš„æœ€å¤§è¿­ä»£æ¬¡æ•¸ã€‚é è¨­ 6ã€‚</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- åŸ·è¡ŒæŒ‰éˆ• -->
                                            <div class="flex justify-center gap-4 mb-6 mt-6">
                                                <button id="start-batch-optimization" class="btn-primary px-8 py-3 rounded-lg font-semibold transition duration-150 ease-in-out flex items-center" style="background: linear-gradient(135deg, var(--primary), var(--accent));">
                                                    <i data-lucide="rocket" class="lucide mr-2"></i>
                                                    é–‹å§‹æ‰¹é‡å„ªåŒ–
                                                </button>
                                                <button id="stop-batch-optimization" class="btn-outline px-8 py-3 rounded-lg font-semibold transition duration-150 ease-in-out flex items-center hidden" style="border-color: var(--destructive); color: var(--destructive);">
                                                    <i data-lucide="square" class="lucide mr-2"></i>
                                                    åœæ­¢å„ªåŒ–
                                                </button>
                                            </div>
                                            
                                            <!-- é€²åº¦é¡¯ç¤º -->
                                            <div id="batch-optimization-progress" class="hidden mb-6">
                                                <div class="card bg-muted/20" style="background-color: color-mix(in srgb, var(--primary) 5%, transparent);">
                                                    <div class="card-header pb-3">
                                                        <div class="flex items-center justify-between">
                                                            <h5 class="card-title text-sm font-medium flex items-center">
                                                                <i id="batch-progress-hourglass" data-lucide="hourglass" class="lucide mr-2 animate-spin text-primary" style="color: var(--primary);"></i>
                                                                å„ªåŒ–é€²åº¦
                                                            </h5>
                                                            <span id="batch-progress-text" class="text-sm text-primary" style="color: var(--primary);">0%</span>
                                                        </div>
                                                    </div>
                                                    <div class="card-content space-y-4">
                                                        <div class="w-full bg-muted rounded-full h-3" style="background-color: var(--muted);">
                                                            <div id="batch-progress-bar" class="bg-primary h-3 rounded-full transition-all duration-300" style="width: 0%; background-color: var(--primary);"></div>
                                                        </div>
                                                        <div class="text-sm space-y-1">
                                                            <div id="batch-progress-detail" class="text-primary" style="color: var(--primary);">æº–å‚™ä¸­...</div>
                                                            <div id="batch-progress-combination" class="font-medium text-primary" style="color: var(--primary);"></div>
                                                            <div id="batch-time-estimate" class="font-medium text-foreground" style="color: var(--foreground);"></div>
                                                            <div id="batch-long-wait-notice" class="hidden p-2 bg-accent/10 border border-accent/20 rounded text-accent" style="background-color: color-mix(in srgb, var(--accent) 10%, transparent); border-color: color-mix(in srgb, var(--accent) 20%, transparent); color: var(--accent);">
                                                                <i data-lucide="clock" class="lucide mr-1"></i>
                                                                ç”±æ–¼æ¸¬è©¦æ¬¡æ•¸èˆ‡é¸æ“‡ç­–ç•¥è¼ƒå¤šï¼Œé ä¼°éœ€è¦è¼ƒé•·ç­‰å¾…æ™‚é–“ï¼Œè«‹è€å¿ƒç­‰å€™...
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Worker ç‹€æ…‹é¢æ¿ -->
                                            <div id="batch-worker-status-panel" class="hidden mb-6">
                                                <div class="card bg-background border border-border" style="background-color: var(--background); border-color: var(--border);">
                                                    <div class="card-header">
                                                        <div class="flex items-center justify-between">
                                                            <h5 class="card-title text-sm font-medium">é‹è¡Œç‹€æ…‹</h5>
                                                            <div class="text-xs text-muted-foreground" style="color: var(--muted-foreground);">
                                                                <span>ä½µç™¼ä¸Šé™: <strong id="batch-current-concurrency">-</strong></span>
                                                                <span class="ml-3">é‹è¡Œä¸­: <strong id="batch-inflight-count">0</strong></span>
                                                            </div>
                                                        </div>
                                                        <div class="text-xs text-muted-foreground mt-1" style="color: var(--muted-foreground);">ä»¥ä¸‹åˆ—å‡ºç›®å‰æ­£åœ¨åŸ·è¡Œæˆ–å‰›å®Œæˆçš„çµ„åˆ (å¦‚å¤šå‰‡é¡¯ç¤ºæœ€æ–°è‹¥å¹²ç­†)</div>
                                                    </div>
                                                    <div class="card-content">
                                                        <div class="overflow-x-auto">
                                                            <table id="batch-worker-status-list" class="min-w-full divide-y divide-border text-sm" style="border-color: var(--border);">
                                                                <thead class="bg-muted" style="background-color: var(--muted);">
                                                                    <tr>
                                                                        <th class="px-2 py-1 text-left text-xs font-medium text-muted-foreground uppercase" style="color: var(--muted-foreground);">#</th>
                                                                        <th class="px-2 py-1 text-left text-xs font-medium text-muted-foreground uppercase" style="color: var(--muted-foreground);">è²·å…¥ç­–ç•¥</th>
                                                                        <th class="px-2 py-1 text-left text-xs font-medium text-muted-foreground uppercase" style="color: var(--muted-foreground);">è³£å‡ºç­–ç•¥</th>
                                                                        <th class="px-2 py-1 text-left text-xs font-medium text-muted-foreground uppercase" style="color: var(--muted-foreground);">ç‹€æ…‹</th>
                                                                        <th class="px-2 py-1 text-left text-xs font-medium text-muted-foreground uppercase" style="color: var(--muted-foreground);">åŸ·è¡Œæ™‚é–“</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="batch-worker-status-tbody" class="bg-background divide-y divide-border" style="background-color: var(--background); border-color: var(--border);"></tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- äº¤å‰å„ªåŒ–é€²åº¦é¡¯ç¤º -->
                                            <div id="cross-optimization-progress" class="hidden mb-6">
                                                <div class="card bg-muted/20" style="background-color: color-mix(in srgb, var(--accent) 5%, transparent);">
                                                    <div class="card-header pb-3">
                                                        <div class="flex items-center justify-between">
                                                            <h5 class="card-title text-sm font-medium flex items-center">
                                                                <i id="cross-progress-icon" data-lucide="arrow-right-left" class="lucide mr-2 animate-pulse text-accent" style="color: var(--accent);"></i>
                                                                äº¤å‰å„ªåŒ–é€²åº¦
                                                            </h5>
                                                            <span id="cross-progress-text" class="text-sm text-accent" style="color: var(--accent);">0%</span>
                                                        </div>
                                                    </div>
                                                    <div class="card-content space-y-4">
                                                        <div class="w-full bg-muted rounded-full h-3" style="background-color: var(--muted);">
                                                            <div id="cross-progress-bar" class="bg-accent h-3 rounded-full transition-all duration-300" style="width: 0%; background-color: var(--accent);"></div>
                                                        </div>
                                                        <div class="text-sm space-y-1">
                                                            <div id="cross-progress-detail" class="text-accent" style="color: var(--accent);">æº–å‚™ä¸­...</div>
                                                            <div id="cross-progress-status" class="font-medium text-accent" style="color: var(--accent);"></div>
                                                            <div id="cross-time-estimate" class="font-medium text-foreground" style="color: var(--foreground);"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- çµæœé¡¯ç¤º -->
                                            <div id="batch-optimization-results" class="hidden">
                                                <div class="card bg-background border border-border" style="background-color: var(--background); border-color: var(--border);">
                                                    <div class="card-header">
                                                        <div class="flex items-center justify-between">
                                                            <h4 class="card-title text-lg font-semibold">å„ªåŒ–çµæœ</h4>
                                                            <div class="flex items-center gap-2">
                                                                <label class="text-xs text-muted-foreground" style="color: var(--muted-foreground);">æ’åºä¾æ“š:</label>
                                                                <select id="batch-sort-key" class="px-3 py-1 border border-border rounded text-sm bg-input text-foreground" style="border-color: var(--border); background-color: var(--input); color: var(--foreground);">
                                                                    <option value="annualizedReturn">å¹´åŒ–å ±é…¬ç‡</option>
                                                                    <option value="sharpeRatio">å¤æ™®æ¯”ç‡</option>
                                                                    <option value="maxDrawdown">æœ€å¤§å›æ’¤</option>
                                                                    <option value="tradeCount">äº¤æ˜“æ¬¡æ•¸</option>
                                                                </select>
                                                                <button id="batch-sort-direction" class="px-2 py-1 btn-outline rounded text-sm">
                                                                    <i data-lucide="arrow-down" class="lucide"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-content">
                                                        <div class="overflow-x-auto">
                                                            <table id="batch-results-table" class="min-w-full divide-y divide-border" style="border-color: var(--border);">
                                                                <thead class="bg-muted" style="background-color: var(--muted);">
                                                                    <tr>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">æ’å</th>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">é¡å‹</th>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">è²·å…¥ç­–ç•¥</th>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">è³£å‡ºç­–ç•¥</th>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">å¹´åŒ–å ±é…¬ç‡</th>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">å¤æ™®æ¯”ç‡</th>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">ç´¢æè«¾æ¯”ç‡</th>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">æœ€å¤§å›æ’¤</th>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">äº¤æ˜“æ¬¡æ•¸</th>
                                                                        <th class="px-3 py-2 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider" style="color: var(--muted-foreground);">æ“ä½œ</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="batch-results-tbody" class="bg-background divide-y divide-border" style="background-color: var(--background); border-color: var(--border);"></tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-content hidden" id="rolling-test-tab">
                                <div class="space-y-6">
                                    <div class="card">
                                        <div class="card-header flex flex-col gap-2">
                                            <h3 class="card-title text-base">æ»¾å‹•æ¸¬è©¦è¨­å®š</h3>
                                            <p class="text-xs leading-relaxed" style="color: var(--muted-foreground);">
                                                åƒè€ƒåœ‹éš›é‡åŒ–æ©Ÿæ§‹å¸¸è¦‹çš„ Walk-Forward æ¸¬è©¦ï¼ˆå…ˆä»¥å›ºå®šè¦–çª—è¨“ç·´ï¼Œå†ç”¨ä¸‹ä¸€æ®µè³‡æ–™é©—è­‰ï¼‰ï¼Œå¿«é€Ÿæª¢æŸ¥ç­–ç•¥åœ¨ä¸åŒå¸‚æ³çš„ç©©å¥åº¦ã€‚
                                                å»ºè­°å…ˆåœ¨å·¦å´åŸ·è¡Œä¸€æ¬¡å®Œæ•´å›æ¸¬ï¼Œä»¥å»ºç«‹å¿«å–è³‡æ–™å¾Œå†é€²è¡Œæ»¾å‹•æ¸¬è©¦ã€‚
                                            </p>
                                        </div>
                                        <div class="card-content">
                                            <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-3">
                                                <label class="flex flex-col gap-1 text-xs font-medium" style="color: var(--foreground);">
                                                    è¨“ç·´è¦–çª—ï¼ˆæœˆï¼‰
                                                    <input id="rolling-training-months" data-rolling-input type="number" min="6" max="120" step="1" value="36" class="px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm" style="border-color: var(--border); background-color: var(--input);" />
                                                    <span class="text-[11px] font-normal" style="color: var(--muted-foreground);">å¤šæ•¸ CTA ä»¥ 24~36 å€‹æœˆä½œç‚ºåƒæ•¸å„ªåŒ–çš„åŸºç¤è¦–çª—ã€‚</span>
                                                </label>
                                                <label class="flex flex-col gap-1 text-xs font-medium" style="color: var(--foreground);">
                                                    æ¸¬è©¦è¦–çª—ï¼ˆæœˆï¼‰
                                                    <input id="rolling-testing-months" data-rolling-input type="number" min="3" max="36" step="1" value="12" class="px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm" style="border-color: var(--border); background-color: var(--input);" />
                                                    <span class="text-[11px] font-normal" style="color: var(--muted-foreground);">å¸¸è¦‹åšæ³•ç‚º 6~12 å€‹æœˆï¼Œè§€å¯Ÿç­–ç•¥æ›å­£å¾Œçš„çºŒèˆªåŠ›ã€‚</span>
                                                </label>
                                                <label class="flex flex-col gap-1 text-xs font-medium" style="color: var(--foreground);">
                                                    è¦–çª—å¹³ç§»ï¼ˆæœˆï¼‰
                                                    <input id="rolling-step-months" data-rolling-input type="number" min="1" max="24" step="1" value="6" class="px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm" style="border-color: var(--border); background-color: var(--input);" />
                                                    <span class="text-[11px] font-normal" style="color: var(--muted-foreground);">å»ºè­°è¨­ç‚ºæ¸¬è©¦è¦–çª—çš„é•·åº¦ï¼Œå½¢æˆä¸é‡ç–Šçš„ Walk-Forward è¿­ä»£ã€‚</span>
                                                </label>
                                                <label class="flex flex-col gap-1 text-xs font-medium" style="color: var(--foreground);">
                                                    æ¸¬è©¦è‡³å°‘æˆäº¤ç­†æ•¸
                                                    <input id="rolling-min-trades" data-rolling-input type="number" min="1" max="200" step="1" value="10" class="px-3 py-2 border border-border rounded-md bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-ring text-sm" style="border-color: var(--border); background-color: var(--input);" />
                                                    <span class="text-[11px] font-normal" style="color: var(--muted-foreground);">è‹¥å°æ–¼é–€æª»ï¼Œå°‡æ¨™è¨»æ¨£æœ¬ä¸è¶³ã€‚</span>
                                                </label>
                                                <fieldset class="flex flex-col gap-2 text-xs" style="color: var(--foreground);">
                                                    <legend class="font-medium">é€šéé–€æª»ï¼ˆæ»¾å‹•æ¸¬è©¦ï¼‰</legend>
                                                    <div class="grid gap-2 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5">
                                                        <label class="flex items-center gap-2">
                                                            <span class="min-w-[70px]">å¹´åŒ–%</span>
                                                            <input id="rolling-threshold-ann" data-rolling-input type="number" min="0" max="100" step="0.1" value="8" class="w-full px-2 py-1 border border-border rounded-md bg-input text-foreground text-xs focus:outline-none focus:ring-1 focus:ring-ring" style="border-color: var(--border); background-color: var(--input);" />
                                                        </label>
                                                        <label class="flex items-center gap-2">
                                                            <span class="min-w-[70px]">Sharpe</span>
                                                            <input id="rolling-threshold-sharpe" data-rolling-input type="number" min="0" max="5" step="0.1" value="1" class="w-full px-2 py-1 border border-border rounded-md bg-input text-foreground text-xs focus:outline-none focus:ring-1 focus:ring-ring" style="border-color: var(--border); background-color: var(--input);" />
                                                        </label>
                                                        <label class="flex items-center gap-2">
                                                            <span class="min-w-[70px]">Sortino</span>
                                                            <input id="rolling-threshold-sortino" data-rolling-input type="number" min="0" max="6" step="0.1" value="1.2" class="w-full px-2 py-1 border border-border rounded-md bg-input text-foreground text-xs focus:outline-none focus:ring-1 focus:ring-ring" style="border-color: var(--border); background-color: var(--input);" />
                                                        </label>
                                                        <label class="flex items-center gap-2">
                                                            <span class="min-w-[70px]">MaxDD%</span>
                                                            <input id="rolling-threshold-maxdd" data-rolling-input type="number" min="1" max="80" step="0.1" value="25" class="w-full px-2 py-1 border border-border rounded-md bg-input text-foreground text-xs focus:outline-none focus:ring-1 focus:ring-ring" style="border-color: var(--border); background-color: var(--input);" />
                                                        </label>
                                                        <label class="flex items-center gap-2">
                                                            <span class="min-w-[70px]">å‹ç‡%</span>
                                                            <input id="rolling-threshold-win" data-rolling-input type="number" min="0" max="100" step="0.1" value="45" class="w-full px-2 py-1 border border-border rounded-md bg-input text-foreground text-xs focus:outline-none focus:ring-1 focus:ring-ring" style="border-color: var(--border); background-color: var(--input);" />
                                                        </label>
                                                    </div>
                                                    <p class="text-[11px]" style="color: var(--muted-foreground);">é–€æª»åƒè€ƒ QuantConnectã€Tradestationã€CME é¡§å•å…¬å¸å¸¸è¦‹çš„ Walk-Forward åˆæ ¼æ¨™æº–ï¼šSharpe â‰¥ 1ã€Sortino â‰¥ 1.2ã€æœ€å¤§å›æ’¤ â‰¤ 25%ã€‚</p>
                                                </fieldset>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-header flex flex-col gap-2">
                                            <h3 class="card-title text-base">è¦–çª—è¦åŠƒé è¦½</h3>
                                            <p class="text-xs" id="rolling-plan-range" style="color: var(--muted-foreground);"></p>
                                        </div>
                                        <div class="card-content space-y-4">
                                            <div class="flex flex-wrap items-center gap-3 text-xs" style="color: var(--muted-foreground);">
                                                <span id="rolling-plan-summary">å°šæœªå»ºç«‹è¦–çª—</span>
                                                <span id="rolling-plan-warning" class="hidden px-2 py-1 rounded bg-amber-100 text-amber-700">è«‹å…ˆåŸ·è¡Œä¸€æ¬¡ä¸»å›æ¸¬ä»¥ç”¢ç”Ÿå¿«å–è³‡æ–™</span>
                                            </div>
                                            <div class="overflow-x-auto">
                                                <table class="min-w-full divide-y divide-border text-xs" style="border-color: var(--border);">
                                                    <thead class="bg-muted/40" style="background-color: color-mix(in srgb, var(--muted) 20%, transparent); color: var(--foreground);">
                                                        <tr>
                                                            <th class="px-3 py-2 text-left font-semibold">è¿­ä»£</th>
                                                            <th class="px-3 py-2 text-left font-semibold">è¨“ç·´æœŸé–“</th>
                                                            <th class="px-3 py-2 text-left font-semibold">æ¸¬è©¦æœŸé–“</th>
                                                            <th class="px-3 py-2 text-left font-semibold">æ¸¬è©¦äº¤æ˜“æ—¥</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="rolling-plan-tbody" class="divide-y divide-border" style="border-color: var(--border);"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-content flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
                                            <div>
                                                <h3 class="text-sm font-semibold" style="color: var(--foreground);">åŸ·è¡Œ Walk-Forward æ¸¬è©¦</h3>
                                                <p class="text-xs mt-1 max-w-xl" style="color: var(--muted-foreground);">ç³»çµ±æœƒä¾åºé‡æ’­æ¯å€‹æ»¾å‹•è¦–çª—ï¼Œæ¡ç”¨ç¾æœ‰ç­–ç•¥åƒæ•¸è¨ˆç®—è¨“ç·´æœŸèˆ‡æ¸¬è©¦æœŸçš„å ±é…¬ã€é¢¨éšªèˆ‡äº¤æ˜“å¯†åº¦ã€‚éç¨‹ä¸­è«‹å‹¿é—œé–‰é é¢ã€‚</p>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <button id="start-rolling-test" class="btn-primary px-6 py-2.5 rounded-lg font-semibold flex items-center gap-2" style="background: linear-gradient(135deg, var(--primary), color-mix(in srgb, var(--accent) 60%, var(--primary)));">
                                                    <i data-lucide="shuffle" class="lucide w-4 h-4"></i>
                                                    é–‹å§‹æ»¾å‹•æ¸¬è©¦
                                                </button>
                                                <button id="stop-rolling-test" class="btn-outline px-6 py-2.5 rounded-lg font-semibold hidden" style="border-color: var(--destructive); color: var(--destructive);">
                                                    <i data-lucide="square" class="lucide w-4 h-4"></i>
                                                    åœæ­¢
                                                </button>
                                            </div>
                                        </div>
                                        <div id="rolling-progress-panel" class="card-content border-t hidden" style="border-color: var(--border);">
                                            <div class="flex flex-col gap-3">
                                                <div class="flex items-center justify-between text-xs" style="color: var(--foreground);">
                                                    <span id="rolling-progress-text">æº–å‚™ä¸­...</span>
                                                    <span id="rolling-progress-percent">0%</span>
                                                </div>
                                                <div class="w-full h-2 rounded-full bg-muted" style="background-color: color-mix(in srgb, var(--muted) 20%, transparent);">
                                                    <div id="rolling-progress-bar" class="h-2 rounded-full" style="background-color: var(--primary); width: 0%;"></div>
                                                </div>
                                                <div class="flex flex-wrap items-center gap-3 text-[11px]" style="color: var(--muted-foreground);">
                                                    <span id="rolling-progress-phase">å°šæœªé–‹å§‹</span>
                                                    <span id="rolling-progress-elapsed" class="hidden"></span>
                                                    <span id="rolling-progress-eta" class="hidden"></span>
                                                </div>
                                                <div id="rolling-progress-alert" class="hidden text-[11px] px-3 py-2 rounded border" style="border-color: color-mix(in srgb, var(--accent) 30%, transparent); color: var(--accent); background-color: color-mix(in srgb, var(--accent) 12%, transparent);"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="rolling-test-report" class="card hidden">
                                        <div class="card-header flex flex-col gap-2">
                                            <h3 class="card-title text-base">æ»¾å‹•æ¸¬è©¦å ±å‘Š</h3>
                                            <p id="rolling-report-intro" class="text-xs" style="color: var(--muted-foreground);"></p>
                                        </div>
                                        <div class="card-content space-y-6">
                                            <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-4" id="rolling-scoreboard"></div>
                                            <div class="p-4 border rounded-lg" style="border-color: var(--border); background-color: color-mix(in srgb, var(--primary) 4%, transparent);">
                                                <h4 class="text-sm font-semibold mb-2" style="color: var(--foreground);">ç¸½çµ</h4>
                                                <p id="rolling-score-summary" class="text-xs leading-relaxed" style="color: var(--muted-foreground);"></p>
                                            </div>
                                            <div>
                                                <h4 class="text-sm font-semibold mb-2" style="color: var(--foreground);">é€çª—æŒ‡æ¨™</h4>
                                                <div class="overflow-x-auto">
                                                    <table class="min-w-full divide-y divide-border text-xs" style="border-color: var(--border);">
                                                        <thead class="bg-muted/40" style="background-color: color-mix(in srgb, var(--muted) 20%, transparent); color: var(--foreground);">
                                                            <tr>
                                                                <th class="px-3 py-2 text-left font-semibold">è¿­ä»£</th>
                                                                <th class="px-3 py-2 text-left font-semibold">æ¸¬è©¦æœŸé–“</th>
                                                                <th class="px-3 py-2 text-right font-semibold">å¹´åŒ–%</th>
                                                                <th class="px-3 py-2 text-right font-semibold">Sharpe</th>
                                                                <th class="px-3 py-2 text-right font-semibold">Sortino</th>
                                                                <th class="px-3 py-2 text-right font-semibold">MaxDD%</th>
                                                                <th class="px-3 py-2 text-right font-semibold">å‹ç‡%</th>
                                                                <th class="px-3 py-2 text-right font-semibold">äº¤æ˜“æ•¸</th>
                                                                <th class="px-3 py-2 text-left font-semibold">è©•èª</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="rolling-window-report" class="divide-y divide-border" style="border-color: var(--border);"></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="text-[11px] leading-relaxed" style="color: var(--muted-foreground);">
                                                <p>è©•åˆ†å…¬å¼çµåˆå¤šå®¶åˆ¸å•†åŠè³‡ç”¢ç®¡ç†å…¬å¸çš„ Walk-Forward æª¢æ ¸ï¼šSharpe èˆ‡ Sortino åæ˜ å ±é…¬é¢¨éšªæ¯”ï¼Œå¹´åŒ–å ±é…¬è¡¡é‡å¢é•·é€Ÿåº¦ï¼Œæœ€å¤§å›æ’¤æ§åˆ¶é¢¨éšªæ•å£ï¼Œå‹ç‡ç¢ºä¿æ¨£æœ¬å¯é æ€§ã€‚ç¸½åˆ† â‰¥ 85 ç‚ºã€Œå°ˆæ¥­åˆæ ¼ã€ã€70~84 å±¬æ–¼ã€Œå¯é€²ä¸€æ­¥é©—è­‰ã€ã€55~69 å»ºè­°èª¿æ•´åƒæ•¸æˆ–åŠ ä¸Šé¢¨æ§ï¼Œä½æ–¼ 55 å‰‡è¦–ç‚ºæœªé€šéã€‚</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <footer class="py-12 mt-16" style="background-color: #f3f4f6; color: #374151;">
                <div class="container mx-auto px-4">
                    <div class="grid md:grid-cols-4 gap-8">
                        <div>
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm" style="background-color: #ffffff;">
                                    <!-- simple brand mark -->
                                    <svg width="28" height="20" viewBox="0 0 28 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
                                        <rect width="28" height="20" rx="4" fill="#0EA5A4" />
                                    </svg>
                                </div>
                                <div>
                                    <span class="text-lg font-bold" style="color: #0f172a;">LazyBacktest</span>
                                    <div class="text-xs" style="color: #6b7280;">å°è‚¡å›æ¸¬ç³»çµ±</div>
                                </div>
                            </div>
                            <p class="text-sm mb-4" style="color: #6b7280;">å…ˆæ­å–œæ‚¨ï¼ŒæŠ•è³‡è³ºéŒ¢ï¼</br> å¦‚æœé€™å€‹ç¶²ç«™å¹«åŠ©æ‚¨æŠ•è³‡é †åˆ©</br> æˆ–è€…å–®ç´”æƒ³æ”¯æŒä¸€ä¸‹éŸ­èœèƒ–å”å”</br>æ­¡è¿æ–—å…§è®“æˆ‘å¯ä»¥ä¸Šè»Šç¹¼çºŒæ›´æ–°</br> ç”¨å¥¶ç²‰ç™¼é›»ï¼Œä¸å†ç”¨æ„›ç™¼é›»</p>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-4" style="color: #374151;">Donate (æ–—å…§/è´ŠåŠ©)</h4>
                            <ul class="space-y-2 text-sm">
                                <li>
                                    <a href="https://payment.opay.tw/Broadcaster/Donate/C0EB7741A027F28BA11ED9BDBEAD263A" target="_blank" rel="noopener" class="transition-colors" style="color: #6b7280;">æ­ä»˜å¯¶</a>
                                </li>
                                <li>
                                    <a href="https://p.ecpay.com.tw/8AB5D6F" target="_blank" rel="noopener" class="transition-colors" style="color: #6b7280;">ç¶ ç•Œ</a>
                                </li>
                                <li>
                                    <a href="https://www.paypal.com/ncp/payment/79RNTHL69MAPE" target="_blank" rel="noopener" class="transition-colors" style="color: #6b7280;">PayPal</a>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-4" style="color: #374151;">æ”¯æ´èˆ‡å¹«åŠ©</h4>
                            <ul class="space-y-2 text-sm">
                                <li><a href="#" class="transition-colors" style="color: #6b7280;">ä½¿ç”¨æ•™å­¸</a></li>
                                <li><a href="#" class="transition-colors" style="color: #6b7280;">å¸¸è¦‹å•é¡Œ</a></li>
                                <li><a href="#" class="transition-colors" style="color: #6b7280;">å¯„ä¿¡çµ¦æˆ‘</a></li>
                                <li><a href="#" class="transition-colors" style="color: #6b7280;">ç¤¾ç¾¤è¨è«–</a></li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-4" style="color: #374151;">å…¶ä»–èªªæ˜</h4>
                            <ul class="space-y-2 text-sm">
                                <li><a href="#" class="transition-colors" style="color: #6b7280;">éš±ç§æ”¿ç­–</a></li>
                                <li><a href="#" class="transition-colors" style="color: #6b7280;">å…è²¬è²æ˜</a></li>
                            </ul>
                        </div>
                    </div>

                    <div class="border-t mt-8 pt-8 text-center text-sm" style="border-color: rgba(0,0,0,0.06); color: #6b7280;">
                        <p style="color: #6b7280;">é„‰æ°‘å…§éƒ¨æ¸¬è©¦ç‰ˆ: å»ºè­°äº‹é …èˆ‡ Bugï¼Œè«‹è¯çµ¡ä¿¡ç®±: <a href="mailto:smallwei0301@gmail.com" class="underline" style="color: #374151;">smallwei0301@gmail.com</a></p>
                        <p style="color: #9ca3af;">Â© 2025 LazyBacktest. åƒ…ä¾›æ•™è‚²èˆ‡ç ”ç©¶ç”¨é€”ï¼Œä¸æ§‹æˆæŠ•è³‡å»ºè­°ã€‚</p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script src="js/shared-lookback.js"></script>
    <script src="js/config.js"></script>
    <script src="js/main.js"></script>
    <script src="js/backtest.js"></script>
    <script src="js/loader.js"></script>
    <script src="js/batch-optimization.js"></script>
    <script src="js/rolling-test.js"></script>
    
    <script>
        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // ä¸€éµå›æ¸¬å°ç©é›»åŠŸèƒ½
            const QUICK_BACKTEST_VERSION = 'LB-QUICK-KEYIN-20251114A';
            const quickBacktestBtn = document.getElementById('quickBacktestBtn');
            const quickBacktestKeywordEl = document.getElementById('quickBacktestKeyword');
            const quickBacktestDefaultLabelEl = document.getElementById('quickBacktestDefaultLabel');
            const quickBacktestStatusTextEl = document.getElementById('quickBacktestStatusText');
            const quickBacktestHintEl = document.getElementById('quickBacktestHint');

            if (quickBacktestBtn && quickBacktestKeywordEl && quickBacktestStatusTextEl) {
                const QUICK_DEFAULT = { keyword: 'å°ç©é›»', code: '2330', market: 'TWSE', name: 'å°ç©é›»' };
                const quickBacktestState = {
                    keyword: QUICK_DEFAULT.keyword,
                    resolution: { code: QUICK_DEFAULT.code, market: QUICK_DEFAULT.market, name: QUICK_DEFAULT.name },
                };
                let progressInterval = null;
                let currentProgress = 0;

                const refreshLucideIcons = () => {
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                };

                const refreshButtonLabel = () => {
                    quickBacktestBtn.setAttribute(
                        'aria-label',
                        `ä¸€éµå›æ¸¬${quickBacktestState.keyword || QUICK_DEFAULT.keyword}ï¼ˆå¯ç·¨è¼¯ï¼‰`
                    );
                };

                const setCaretVisibility = (isHidden) => {
                    if (!quickBacktestKeywordEl) return;
                    if (isHidden) {
                        quickBacktestKeywordEl.setAttribute('data-caret-hidden', 'true');
                    } else {
                        quickBacktestKeywordEl.removeAttribute('data-caret-hidden');
                    }
                };

                const sanitizeQuickKeyword = (raw) => {
                    if (typeof raw !== 'string') return '';
                    return raw
                        .replace(/[\n\r\t]+/g, ' ')
                        .replace(/\u00A0/g, ' ')
                        .replace(/\s{2,}/g, ' ')
                        .trim()
                        .slice(0, 18);
                };

                const toggleButtonState = (state, options = {}) => {
                    quickBacktestBtn.dataset.state = state;
                    if (state === 'idle') {
                        quickBacktestBtn.disabled = false;
                        quickBacktestBtn.style.opacity = '1';
                        quickBacktestStatusTextEl.classList.add('hidden');
                        if (quickBacktestDefaultLabelEl) {
                            quickBacktestDefaultLabelEl.classList.remove('hidden');
                        }
                        quickBacktestStatusTextEl.innerHTML = '';
                        refreshLucideIcons();
                        return;
                    }

                    if (state === 'progress') {
                        quickBacktestBtn.disabled = true;
                        quickBacktestBtn.style.opacity = '0.7';
                        if (quickBacktestDefaultLabelEl) {
                            quickBacktestDefaultLabelEl.classList.add('hidden');
                        }
                        quickBacktestStatusTextEl.classList.remove('hidden');
                        const progressText = Math.round(options.progress ?? 0);
                        quickBacktestStatusTextEl.innerHTML = `
                            <i data-lucide="loader-2" class="lucide mr-3 animate-spin"></i>
                            å›æ¸¬ä¸­...${progressText}%
                        `;
                        refreshLucideIcons();
                        return;
                    }

                    if (state === 'success') {
                        quickBacktestBtn.disabled = false;
                        quickBacktestBtn.style.opacity = '1';
                        if (quickBacktestDefaultLabelEl) {
                            quickBacktestDefaultLabelEl.classList.add('hidden');
                        }
                        quickBacktestStatusTextEl.classList.remove('hidden');
                        const message = options.message || 'å®Œæˆï¼è«‹çœ‹ä¸‹é¢ç¸¾æ•ˆè¡¨ç¾';
                        quickBacktestStatusTextEl.innerHTML = `
                            <i data-lucide="check-circle" class="lucide mr-3"></i>
                            ${message}
                        `;
                        refreshLucideIcons();
                        return;
                    }

                    if (state === 'error') {
                        quickBacktestBtn.disabled = false;
                        quickBacktestBtn.style.opacity = '1';
                        if (quickBacktestDefaultLabelEl) {
                            quickBacktestDefaultLabelEl.classList.remove('hidden');
                        }
                        quickBacktestStatusTextEl.classList.add('hidden');
                        quickBacktestStatusTextEl.innerHTML = '';
                        refreshLucideIcons();
                    }
                };

                const updateHintDisplay = (resolution) => {
                    if (!quickBacktestHintEl) return;
                    if (resolution && resolution.code) {
                        const marketLabel = resolution.market && typeof getMarketDisplayName === 'function'
                            ? getMarketDisplayName(resolution.market)
                            : resolution.market || '';
                        const marketText = marketLabel ? `ï¼ˆ${marketLabel}ï¼‰` : '';
                        const displayName = resolution.name
                            ? resolution.name
                            : (resolution.code !== quickBacktestState.keyword ? quickBacktestState.keyword : '');
                        const nameText = displayName ? `ï¼ˆ${displayName}ï¼‰` : '';
                        quickBacktestHintEl.textContent = `å°‡ä½¿ç”¨ ${resolution.code}${nameText}${marketText}é€²è¡Œä¸€éµå›æ¸¬ã€‚`;
                        quickBacktestHintEl.dataset.status = 'resolved';
                    } else {
                        quickBacktestHintEl.textContent = `æ‰¾ä¸åˆ°ã€Œ${quickBacktestState.keyword}ã€å°æ‡‰çš„å®˜æ–¹ä»£ç¢¼ï¼Œå°‡ä»¥åŸæ–‡å­—å˜—è©¦å›æ¸¬ã€‚`;
                        quickBacktestHintEl.dataset.status = 'unresolved';
                    }
                };

                const setStockInputValue = (stockCode, options = {}) => {
                    const stockInput = document.getElementById('stockNo');
                    if (!stockInput) return;
                    const normalized = options.keepCase
                        ? (stockCode || '').trim()
                        : (stockCode || '').trim().toUpperCase();
                    if (!normalized) return;
                    if (stockInput.value.trim() === normalized) return;
                    stockInput.value = normalized;
                    stockInput.dispatchEvent(new Event('input', { bubbles: true }));
                };

                const updateMarketSelect = (market) => {
                    if (!market) return;
                    const marketSelect = document.getElementById('marketSelect');
                    if (!marketSelect) return;
                    if (marketSelect.value === market) return;
                    marketSelect.value = market;
                    marketSelect.dispatchEvent(new Event('change', { bubbles: true }));
                };

                const detectDirectStockCode = (keyword) => {
                    const raw = (keyword || '').trim();
                    if (!raw) return null;
                    const upper = raw.toUpperCase();
                    if (/^\d{4}$/.test(upper)) {
                        return { code: upper, market: 'TWSE' };
                    }
                    if (/^\d{5,6}$/.test(upper)) {
                        return { code: upper, market: upper.startsWith('00') ? 'TWSE' : null };
                    }
                    if (/^\d{4}[A-Z]$/.test(upper)) {
                        return { code: upper, market: null };
                    }
                    if (/^[A-Z]{1,6}(?:\.[A-Z]{1,3}|-[A-Z]{1,2})?$/.test(upper)) {
                        return { code: upper, market: 'US' };
                    }
                    return null;
                };

                const resolveKeywordToStock = async (keyword) => {
                    const trimmed = (keyword || '').trim();
                    if (!trimmed) {
                        return { ...QUICK_DEFAULT };
                    }

                    const direct = detectDirectStockCode(trimmed);
                    if (direct) {
                        const cached = typeof resolveCachedStockNameInfo === 'function'
                            ? resolveCachedStockNameInfo(direct.code, direct.market)
                            : null;
                        return {
                            code: direct.code,
                            market: cached?.market || direct.market || null,
                            name: cached?.info?.name || null,
                        };
                    }

                    if (trimmed.length < 2) {
                        return null;
                    }

                    const tokens = trimmed
                        .replace(/[ï¼Œã€,]+/g, ' ')
                        .split(/\s+/)
                        .map((token) => token.trim())
                        .filter(Boolean);

                    if (tokens.length === 0) {
                        return null;
                    }

                    if (typeof ensureTaiwanDirectoryReady === 'function') {
                        try {
                            await ensureTaiwanDirectoryReady({});
                        } catch (error) {
                            console.warn(`[${QUICK_BACKTEST_VERSION}] å°è‚¡å®˜æ–¹æ¸…å–®è¼‰å…¥å¤±æ•—:`, error);
                        }
                    }

                    const directoryEntries = (typeof taiwanDirectoryState !== 'undefined'
                        && taiwanDirectoryState.entries instanceof Map)
                        ? Array.from(taiwanDirectoryState.entries.values())
                        : [];

                    let bestMatch = null;
                    for (const entry of directoryEntries) {
                        if (!entry || !entry.name || !entry.stockId) continue;
                        const entryName = entry.name;
                        const normalizedName = entryName.replace(/\s+/g, '');
                        const upperId = entry.stockId.toUpperCase();
                        let score = 0;
                        for (const token of tokens) {
                            const upperToken = token.toUpperCase();
                            if (upperId.includes(upperToken)) {
                                score += 6;
                            }
                            if (entryName.includes(token)) {
                                score += entryName.startsWith(token) ? 6 : 4;
                            } else if (normalizedName.includes(token)) {
                                score += 3;
                            }
                        }
                        if (score > 0) {
                            if (!bestMatch || score > bestMatch.score || (
                                score === bestMatch.score
                                && upperId < bestMatch.entry.stockId
                            )) {
                                bestMatch = { entry, score };
                            }
                        }
                    }

                    if (!bestMatch) {
                        return null;
                    }

                    return {
                        code: bestMatch.entry.stockId,
                        market: bestMatch.entry.market || null,
                        name: bestMatch.entry.name || null,
                    };
                };

                const commitQuickKeyword = async (options = {}) => {
                    const rawValue = quickBacktestKeywordEl.textContent || '';
                    const sanitized = sanitizeQuickKeyword(rawValue);
                    if (sanitized !== rawValue) {
                        quickBacktestKeywordEl.textContent = sanitized;
                    }
                    const keyword = sanitized || QUICK_DEFAULT.keyword;
                    if (!sanitized) {
                        quickBacktestKeywordEl.textContent = QUICK_DEFAULT.keyword;
                    }
                    quickBacktestState.keyword = keyword;
                    refreshButtonLabel();

                    const resolution = await resolveKeywordToStock(keyword);
                    if (resolution && resolution.code) {
                        quickBacktestState.resolution = resolution;
                        quickBacktestKeywordEl.removeAttribute('aria-invalid');
                        updateHintDisplay(resolution);
                        setStockInputValue(resolution.code);
                        updateMarketSelect(resolution.market);
                        return resolution;
                    }

                    quickBacktestState.resolution = { code: null, market: null, name: null };
                    quickBacktestKeywordEl.setAttribute('aria-invalid', 'true');
                    updateHintDisplay(null);
                    setStockInputValue(keyword, { keepCase: true });
                    if (!options.silent && typeof showStockName === 'function') {
                        showStockName(`æ‰¾ä¸åˆ°ã€Œ${keyword}ã€å°æ‡‰çš„ä»£ç¢¼`, 'error');
                    }
                    return null;
                };

                const startProgressCycle = () => {
                    currentProgress = 0;
                    toggleButtonState('progress', { progress: currentProgress });
                    if (progressInterval) {
                        clearInterval(progressInterval);
                    }
                    progressInterval = setInterval(() => {
                        currentProgress += Math.random() * 15 + 5;
                        if (currentProgress > 95) {
                            currentProgress = 95;
                        }
                        toggleButtonState('progress', { progress: currentProgress });
                    }, 800);
                };

                const stopProgressCycle = () => {
                    if (progressInterval) {
                        clearInterval(progressInterval);
                        progressInterval = null;
                    }
                };

                const scheduleCompletionWatcher = () => {
                    const checkBacktestComplete = () => {
                        const resultElement = document.getElementById('backtest-result');
                        if (resultElement && resultElement.textContent.trim() !== 'åŸ·è¡Œå›æ¸¬å¾Œå°‡é¡¯ç¤ºè©³ç´°çµæœ') {
                            stopProgressCycle();
                            toggleButtonState('success');
                            setTimeout(() => {
                                toggleButtonState('idle');
                            }, 3000);
                        } else {
                            setTimeout(checkBacktestComplete, 500);
                        }
                    };
                    setTimeout(checkBacktestComplete, 1800);
                };

                quickBacktestKeywordEl.addEventListener('focus', () => {
                    setCaretVisibility(true);
                });

                quickBacktestKeywordEl.addEventListener('blur', () => {
                    setCaretVisibility(false);
                    commitQuickKeyword({ silent: true });
                });

                quickBacktestKeywordEl.addEventListener('keydown', (event) => {
                    event.stopPropagation();
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        quickBacktestKeywordEl.blur();
                    }
                });

                quickBacktestKeywordEl.addEventListener('input', () => {
                    const sanitized = sanitizeQuickKeyword(quickBacktestKeywordEl.textContent || '');
                    if (quickBacktestKeywordEl.textContent !== sanitized) {
                        quickBacktestKeywordEl.textContent = sanitized;
                        const range = document.createRange();
                        range.selectNodeContents(quickBacktestKeywordEl);
                        range.collapse(false);
                        const selection = window.getSelection();
                        selection.removeAllRanges();
                        selection.addRange(range);
                    }
                    quickBacktestState.keyword = sanitized || QUICK_DEFAULT.keyword;
                    refreshButtonLabel();
                });

                quickBacktestKeywordEl.addEventListener('paste', (event) => {
                    event.preventDefault();
                    const text = sanitizeQuickKeyword((event.clipboardData || window.clipboardData).getData('text') || '');
                    const selection = window.getSelection();
                    if (!selection || selection.rangeCount === 0) return;
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    range.insertNode(document.createTextNode(text));
                    range.collapse(false);
                    quickBacktestKeywordEl.dispatchEvent(new Event('input'));
                });

                quickBacktestKeywordEl.addEventListener('click', (event) => {
                    event.stopPropagation();
                });

                quickBacktestBtn.addEventListener('click', async () => {
                    if (quickBacktestBtn.dataset.state === 'progress') {
                        return;
                    }

                    stopProgressCycle();
                    await commitQuickKeyword({ silent: false });
                    const stockInput = document.getElementById('stockNo');
                    const targetCode = stockInput ? stockInput.value.trim() : '';
                    if (!targetCode) {
                        toggleButtonState('error');
                        return;
                    }

                    startProgressCycle();

                    const endDate = new Date();
                    const startDate = new Date();
                    startDate.setFullYear(endDate.getFullYear() - 1);

                    const startDateInput = document.getElementById('startDate');
                    const endDateInput = document.getElementById('endDate');
                    if (startDateInput) {
                        startDateInput.value = startDate.toISOString().split('T')[0];
                    }
                    if (endDateInput) {
                        endDateInput.value = endDate.toISOString().split('T')[0];
                    }

                    const backtestBtn = document.getElementById('backtestBtn');
                    if (backtestBtn) {
                        backtestBtn.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center',
                            inline: 'nearest'
                        });
                        setTimeout(() => {
                            backtestBtn.click();
                            scheduleCompletionWatcher();
                        }, 800);
                    } else {
                        stopProgressCycle();
                        toggleButtonState('idle');
                    }
                });

                // åˆå§‹åŒ–æç¤ºèˆ‡è¼¸å…¥æ¡†ç‹€æ…‹
                quickBacktestKeywordEl.textContent = QUICK_DEFAULT.keyword;
                refreshButtonLabel();
                updateHintDisplay(quickBacktestState.resolution);
            }
            
            // Tab switching functionality with updated design
            document.querySelectorAll('[data-tab]').forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update button states
                    document.querySelectorAll('[data-tab]').forEach(btn => {
                        btn.className = 'tab py-4 px-1 border-b-2 border-transparent text-muted hover:text-foreground font-medium text-xs whitespace-nowrap';
                        btn.style.color = 'var(--muted-foreground)';
                        btn.style.borderColor = 'transparent';
                    });
                    this.className = 'tab py-4 px-1 border-b-2 border-primary text-primary font-medium text-xs whitespace-nowrap';
                    this.style.color = 'var(--primary)';
                    this.style.borderColor = 'var(--primary)';
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(tab => {
                        tab.classList.add('hidden');
                        tab.classList.remove('active');
                    });
                    const targetTab = document.getElementById(tabName + '-tab');
                    if (targetTab) {
                        targetTab.classList.remove('hidden');
                        targetTab.classList.add('active');
                    }
                });
            });
            
            // Enhanced hover effects for tabs
            document.querySelectorAll('[data-tab]').forEach(button => {
                button.addEventListener('mouseenter', function() {
                    if (!this.classList.contains('border-primary')) {
                        this.style.color = 'var(--foreground)';
                        this.style.borderColor = 'color-mix(in srgb, var(--border) 60%, transparent)';
                    }
                });
                
                button.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('border-primary')) {
                        this.style.color = 'var(--muted-foreground)';
                        this.style.borderColor = 'transparent';
                    }
                });
            });
            
            // Enhanced button hover effects
            document.querySelectorAll('.btn-outline').forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = 'var(--accent)';
                    this.style.color = 'var(--accent-foreground)';
                    this.style.borderColor = 'var(--accent)';
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = 'var(--foreground)';
                    this.style.borderColor = 'var(--border)';
                });
            });
            
            // Primary button hover effects
            document.querySelectorAll('.btn-primary').forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = 'color-mix(in srgb, var(--primary) 90%, black)';
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = 'var(--primary)';
                });
            });
            
            // Secondary button hover effects  
            document.querySelectorAll('.btn-secondary').forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = 'color-mix(in srgb, var(--secondary) 90%, black)';
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = 'var(--secondary)';
                });
            });
            
            // Initialize default tab (summary)
            const defaultTabButton = document.querySelector('[data-tab="summary"]');
            if (defaultTabButton) {
                defaultTabButton.className = 'tab py-4 px-1 border-b-2 border-primary text-primary font-medium text-xs whitespace-nowrap';
                defaultTabButton.style.color = 'var(--primary)';
                defaultTabButton.style.borderColor = 'var(--primary)';
            }
            
            const defaultTabContent = document.getElementById('summary-tab');
            if (defaultTabContent) {
                defaultTabContent.classList.remove('hidden');
                defaultTabContent.classList.add('active');
            }
        });
    </script>
    <div
        id="priceInspectorModal"
        class="fixed inset-0 z-40 hidden"
        style="background-color: rgba(15, 23, 42, 0.35);"
    >
        <div class="w-full h-full flex items-center justify-center p-4">
            <div
                class="w-full max-w-5xl max-h-[80vh] bg-background border rounded-lg shadow-xl flex flex-col"
                style="background-color: var(--card); border-color: var(--border); color: var(--foreground);"
            >
                <div class="flex items-start justify-between gap-4 px-4 py-3 border-b" style="border-color: var(--border);">
                    <div>
                        <h2 class="text-sm font-semibold">å€é–“åƒ¹æ ¼æ˜ç´°</h2>
                        <p id="priceInspectorSubtitle" class="text-[11px] mt-1" style="color: var(--muted-foreground);"></p>
                    </div>
                    <button
                        type="button"
                        id="closePriceInspector"
                        class="text-[11px] px-2 py-1 rounded-md border"
                        style="border-color: var(--border); color: var(--muted-foreground); background-color: var(--background);"
                    >
                        é—œé–‰
                    </button>
                </div>
                <div class="flex-1 overflow-hidden">
                    <div
                        id="priceInspectorDebugPanel"
                        class="px-4 py-3 border-b hidden"
                        style="border-color: var(--border); color: var(--muted-foreground);"
                    ></div>
                    <div class="overflow-auto max-h-[60vh]" tabindex="0">
                        <table class="min-w-full text-xs">
                            <thead style="background-color: var(--muted); color: var(--foreground);">
                                <tr id="priceInspectorHeaderRow"></tr>
                            </thead>
                            <tbody id="priceInspectorTableBody" class="divide-y" style="border-color: var(--border);"></tbody>
                        </table>
                    </div>
                </div>
                <div class="px-4 py-2 text-[11px]" style="color: var(--muted-foreground);">
                    è¨ˆç®—å…¬å¼ä»¥ã€ŒåŸå§‹æ”¶ç›¤åƒ¹ Ã— é‚„åŸå› å­ = é‚„åŸæ”¶ç›¤åƒ¹ã€å‘ˆç¾ï¼›è‹¥é¡¯ç¤ºã€Œæœªèª¿æ•´ã€æˆ–é‚„åŸå› å­ç‚ºç©ºå€¼ï¼Œä»£è¡¨è©²ç­†åƒ¹æ ¼æ²¿ç”¨åŸå§‹è³‡æ–™ã€‚
                </div>
            </div>
        </div>
    </div>
</body>
</html>
